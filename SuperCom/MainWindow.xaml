<super:BaseWindow
    x:Class="SuperCom.MainWindow"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:avalonEdit="http://icsharpcode.net/sharpdevelop/avalonedit"
    xmlns:config="clr-namespace:SuperCom.Config"
    xmlns:converter="clr-namespace:SuperCom.Converters"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:diag="clr-namespace:System.Diagnostics;assembly=WindowsBase"
    xmlns:local="clr-namespace:SuperCom"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:super="https://github.com/SuperStudio/SuperControls"
    Name="mainWindow"
    Title="{DynamicResource AppTitle}"
    Width="1200"
    Height="700"
    MinWidth="700"
    AutomationProperties.AutomationId="MainWindow"
    Background="{DynamicResource Window.Background}"
    Closing="mainWindow_Closing"
    ContentRendered="mainWindow_ContentRendered"
    Foreground="{DynamicResource Window.Foreground}"
    Icon="pack://application:,,,/Resources/Ico/ICON.ico"
    Loaded="mainWindow_Loaded"
    MenuAlign="Left"
    MenuMargin="200 0 0 0"
    PreviewKeyDown="onPreviewKeyDown"
    PreviewMouseDown="onPreviewMouseDown"
    ShowThemeSelector="True"
    TitleHeight="30"
    TitleMargin="5 0"
    WindowStartupLocation="CenterScreen"
    mc:Ignorable="d">

    <super:BaseWindow.Resources>

        <ContextMenu x:Key="TextEditorContextMenu">
            <MenuItem Command="ApplicationCommands.SelectAll" Header="{DynamicResource SelectAllText}" />
            <MenuItem Command="ApplicationCommands.Copy" Header="{DynamicResource Copy}" />
            <MenuItem Header="{DynamicResource FormatText}">
                <MenuItem Click="FormatJson" Header="JSON(F2)" />
            </MenuItem>
            <MenuItem Header="{DynamicResource Edit}">
                <MenuItem Click="JoinLine" Header="{DynamicResource JoinLine}" />
            </MenuItem>
            <MenuItem Click="OpenHexTransform" Header="{DynamicResource HexTransform}" />
            <MenuItem Click="OpenTimeTransform" Header="{DynamicResource TimeStamp}" />
        </ContextMenu>

        <Style x:Key="BgHoverBorder" TargetType="Border">
            <Setter Property="FocusVisualStyle" Value="{x:Null}" />
            <Setter Property="CornerRadius" Value="0" />
            <Setter Property="Background" Value="{DynamicResource Window.Title.Background}" />
            <Setter Property="Cursor" Value="Hand" />
            <Setter Property="Opacity" Value="0.8" />
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Background" Value="{DynamicResource Window.Title.Hover.Background}" />
                </Trigger>
            </Style.Triggers>
        </Style>

        <converter:ComboBoxSelectedIndexConverter x:Key="ComboBoxSelectedIndexConverter" />

    </super:BaseWindow.Resources>

    <Grid>
        <Popup
            x:Name="ForegroundPopup"
            AllowsTransparency="True"
            HorizontalOffset="-80"
            Placement="MousePoint"
            PopupAnimation="Fade"
            StaysOpen="True"
            VerticalOffset="0">
            <Grid Margin="5">
                <Border
                    Margin="5"
                    Background="{DynamicResource Menu.Background}"
                    CornerRadius="5"
                    Effect="{StaticResource PopupDropShadowEffect}" />
                <StackPanel Orientation="Vertical" Tag="{Binding RelativeSource={RelativeSource Mode=FindAncestor, AncestorType={x:Type ContextMenu}}}">
                    <super:ColorPicker
                        Name="colorPicker"
                        SelectedColorChanged="colorPicker_SelectedColorChanged"
                        ShowColorPalette="False" />
                    <Button
                        Margin="5,0,5,10"
                        HorizontalAlignment="Center"
                        Click="CloseForegroundSelected"
                        Content="{DynamicResource Close}"
                        Style="{StaticResource ButtonDanger}" />
                </StackPanel>
            </Grid>
        </Popup>




        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="*" />
                <RowDefinition Height="auto" />

            </Grid.RowDefinitions>

            <Grid>
                <Menu x:Name="TopMenus">
                    <MenuItem
                        Background="{DynamicResource Window.Title.Background}"
                        Header="{DynamicResource File}"
                        Style="{StaticResource TopMenuItemStyle}">
                        <MenuItem Click="OpenLog" Header="{DynamicResource LoadLog}" />
                        <MenuItem
                            Click="SaveLog"
                            Header="{DynamicResource SaveLogAs}"
                            Icon="/Resources/Pictures/save.png" />
                        <Separator Margin="-20,5,10,5" />
                        <MenuItem Click="ExportAllCmd" Header="{DynamicResource ExportConfig}" />
                        <MenuItem Click="ImportAllCmd" Header="{DynamicResource ImportConfig}" />
                        <Separator Margin="-20,5,10,5" />
                        <MenuItem Click="OpenAppDir" Header="{DynamicResource OpenAppPath}" />
                    </MenuItem>
                    <MenuItem
                        Background="{DynamicResource Window.Title.Background}"
                        Header="{DynamicResource Edit}"
                        Style="{StaticResource TopMenuItemStyle}">
                        <MenuItem
                            Header="{DynamicResource AutoWrap}"
                            IsCheckable="True"
                            IsChecked="{Binding AutoWrap, Source={x:Static config:ConfigManager.Main}}" />
                        <Separator Margin="-20,5,10,5" />
                        <MenuItem
                            Name="FontMenuItem"
                            Header="{DynamicResource Font}"
                            IsCheckable="False" />
                        <MenuItem
                            Click="OpenForegroundSelected"
                            Header="{DynamicResource FontColor}"
                            IsCheckable="False" />
                        <Separator Margin="-20,5,10,5" />
                        <MenuItem
                            Click="SetTextViewReturn"
                            Header="{DynamicResource ShowReturnChar}"
                            IsCheckable="True"
                            IsChecked="{Binding ShowEndOfLine, Source={x:Static config:ConfigManager.Main}}" />
                        <MenuItem
                            Click="SetTextViewSpace"
                            Header="{DynamicResource ShowSpace}"
                            IsCheckable="True"
                            IsChecked="{Binding ShowSpaces, Source={x:Static config:ConfigManager.Main}}" />
                        <MenuItem
                            Click="SetTextViewTab"
                            Header="{DynamicResource ShowTab}"
                            IsCheckable="True"
                            IsChecked="{Binding ShowTabs, Source={x:Static config:ConfigManager.Main}}" />
                        <MenuItem
                            Click="SetTextViewLineNumber"
                            Header="{DynamicResource ShowLineNumber}"
                            IsCheckable="True"
                            IsChecked="{Binding HighlightCurrentLine, Source={x:Static config:ConfigManager.Main}}" />
                        <MenuItem
                            Click="SetTextHighLightCurrent"
                            Header="{DynamicResource HighLightSelectLine}"
                            IsCheckable="True"
                            IsChecked="{Binding ShowLineNumbers, Source={x:Static config:ConfigManager.Main}}" />
                    </MenuItem>
                    <MenuItem
                        Background="{DynamicResource Window.Title.Background}"
                        Header="{DynamicResource View_}"
                        Style="{StaticResource TopMenuItemStyle}">
                        <MenuItem
                            Name="sideGridMenuItem"
                            Click="HideSide"
                            Header="{DynamicResource SideBar}"
                            IsCheckable="True"
                            IsChecked="True" />
                        <!--<MenuItem
                                            Header="{DynamicResource RightFuncBar}"
                                            IsCheckable="True"
                                            IsChecked="{Binding ShowRightPanel, Source={x:Static config:ConfigManager.Main}, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" />-->

                    </MenuItem>
                    <MenuItem
                        Background="{DynamicResource Window.Title.Background}"
                        Header="{DynamicResource Tools}"
                        Style="{StaticResource TopMenuItemStyle}">
                        <MenuItem
                            Click="OpenSetting"
                            Header="{DynamicResource Settings}"
                            Icon="/Resources/Pictures/setting.png" />

                        <MenuItem Click="OpenShortCut" Header="{DynamicResource FastKey}" />
                        <MenuItem Click="ShowPluginWindow" Header="{DynamicResource Plugin}" />
                        <Separator Margin="-20,5,10,5" />
                        <MenuItem
                            Click="ShowVarMonitor"
                            Header="{DynamicResource Monitor}"
                            Visibility="Collapsed" />
                        <MenuItem Click="ShowVirtualPort" Header="{DynamicResource VirtualSerialPort}" />
                        <Separator Margin="-20,5,10,5" />
                        <MenuItem
                            Click="ShowAscii"
                            Header="{DynamicResource AsciiTable}"
                            IsCheckable="False" />
                        <MenuItem
                            Click="ShowReferences"
                            Header="{DynamicResource RefDoc}"
                            IsCheckable="False" />
                        <Separator Margin="-20,5,10,5" />
                        <MenuItem
                            Click="StartTelnetServer"
                            Header="{DynamicResource TelnetServer}"
                            IsCheckable="False" />
                    </MenuItem>
                    <MenuItem
                        AutomationProperties.AutomationId="MenuItem_About"
                        Background="{DynamicResource Window.Title.Background}"
                        Header="{DynamicResource About}"
                        Style="{StaticResource TopMenuItemStyle}">
                        <MenuItem
                            AutomationProperties.AutomationId="MenuItem_ShowUpgrade"
                            Click="ShowUpgradeWindow"
                            Header="{DynamicResource CheckUpgrade}"
                            Icon="/Resources/Pictures/update.png" />
                        <MenuItem
                            Click="ShowAbout"
                            Header="{DynamicResource About}"
                            Icon="/Resources/Pictures/about.png" />
                        <MenuItem Click="OpenFeedBack" Header="{DynamicResource FeedBack}" />
                        <MenuItem Click="OpenHelp" Header="{DynamicResource Help}" />
                        <MenuItem Click="OpenHFAQ" Header="{DynamicResource FAQ}" />
                        <MenuItem
                            Click="OpenDevelop"
                            Header="{DynamicResource DevelopTogether}"
                            Icon="/Resources/Pictures/develop.png" />

                    </MenuItem>

                </Menu>
            </Grid>

            <Grid Grid.Row="0">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition
                        Name="SideGridColumn"
                        Width="{Binding SideGridWidth, FallbackValue=200, Mode=OneWay}"
                        MaxWidth="500" />
                    <ColumnDefinition Width="5" />
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="auto" />
                </Grid.ColumnDefinitions>

                <Grid
                    Grid.ColumnSpan="10"
                    Panel.ZIndex="99"
                    Visibility="{Binding DoingLongWork, Converter={StaticResource BoolToVisibilityConverter}, FallbackValue=Collapsed}">
                    <Border Background="{DynamicResource Window.Title.Background}" Opacity="0.7" />
                    <Grid>
                        <Border
                            Width="200"
                            Height="200"
                            Background="{DynamicResource Window.Side.Background}"
                            Effect="{StaticResource PopupDropShadowEffect}" />
                        <StackPanel
                            HorizontalAlignment="Center"
                            VerticalAlignment="Center"
                            Orientation="Vertical">
                            <super:LoadingCircle Width="40" Height="40" />
                            <TextBlock
                                Margin="10"
                                Style="{StaticResource BaseTextBlock}"
                                Text="{Binding DoingWorkMsg}" />
                        </StackPanel>
                    </Grid>
                </Grid>

                <Border
                    Name="sideBorder"
                    Grid.Column="0"
                    Background="{DynamicResource Window.Side.Background}"
                    SizeChanged="Border_SizeChanged">
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="auto" />
                            <RowDefinition Height="*" />
                            <RowDefinition Height="auto" />
                        </Grid.RowDefinitions>
                        <StackPanel Grid.Row="0" Orientation="Horizontal">


                            <super:HoverPath
                                Margin="5"
                                Click="RefreshPortsStatus"
                                Style="{StaticResource RefreshHoverPath}" />
                            <super:HoverPath
                                Margin="5"
                                MenuOnLeftClick="True"
                                Style="{StaticResource ToolsHoverPath}">
                                <super:HoverPath.ContextMenu>
                                    <ContextMenu HorizontalOffset="-50">

                                        <MenuItem Click="OpenAllPort" Header="{DynamicResource OpenAllPort}" />
                                        <MenuItem Click="CloseAllPort" Header="{DynamicResource CloseAllPort}" />
                                        <MenuItem Click="ShowAllHidePort" Header="{DynamicResource ShowHidePort}" />
                                    </ContextMenu>
                                </super:HoverPath.ContextMenu>
                            </super:HoverPath>

                            <super:HoverPath Style="{StaticResource SortHoverPath}">
                                <super:HoverPath.ContextMenu>
                                    <ContextMenu HorizontalOffset="-50">

                                        <MenuItem
                                            super:MenuItemExt.Desc="True"
                                            super:MenuItemExt.Sortable="True"
                                            Click="SortSidePorts"
                                            Header="{DynamicResource SortByAddDate}"
                                            Style="{StaticResource SortMenuItemStyle}"
                                            Tag="AddTime" />
                                        <MenuItem
                                            Click="SortSidePorts"
                                            Header="{DynamicResource SortByName}"
                                            Style="{StaticResource SortMenuItemStyle}"
                                            Tag="PortName" />
                                    </ContextMenu>
                                </super:HoverPath.ContextMenu>
                            </super:HoverPath>


                            <!--<Image
                                Grid.Column="0"
                                Width="24"
                                Height="24"
                                Margin="5,0"
                                HorizontalAlignment="Left"
                                Source="{Binding Icon, RelativeSource={RelativeSource Mode=FindAncestor, AncestorType={x:Type Window}}}"
                                Stretch="UniformToFill" />-->


                        </StackPanel>
                        <ScrollViewer Grid.Row="1">
                            <StackPanel Orientation="Vertical">
                                <!--<Expander
                                    Padding="0,5"
                                    HorizontalAlignment="Stretch"
                                    VerticalAlignment="Stretch"
                                    Foreground="{DynamicResource Window.Foreground}"
                                    Header="串口"
                                    IsExpanded="True">-->
                                <ListBox
                                    HorizontalContentAlignment="Stretch"
                                    d:ItemsSource="{d:SampleData ItemCount=5}"
                                    Background="Transparent"
                                    ItemsSource="{Binding SideComPorts}"
                                    ScrollViewer.HorizontalScrollBarVisibility="Hidden"
                                    Style="{StaticResource NormalListBox}">
                                    <ListBox.ItemContainerStyle>
                                        <Style BasedOn="{StaticResource BaseListBoxItem}" TargetType="{x:Type ListBoxItem}">
                                            <Setter Property="Padding" Value="0" />
                                            <Setter Property="Background" Value="Transparent" />
                                            <Style.Triggers>
                                                <DataTrigger Binding="{Binding Hide}" Value="True">
                                                    <Setter Property="Visibility" Value="Collapsed" />
                                                </DataTrigger>
                                            </Style.Triggers>
                                        </Style>
                                    </ListBox.ItemContainerStyle>
                                    <ListBox.ItemTemplate>
                                        <DataTemplate>
                                            <Border
                                                Width="{Binding RelativeSource={RelativeSource FindAncestor, AncestorType={x:Type ListBox}}, Path=ActualWidth, Converter={StaticResource WidthConverter}, ConverterParameter=-15}"
                                                Margin="0,2"
                                                Background="{DynamicResource ListBoxItem.Background}"
                                                CornerRadius="5">
                                                <Grid
                                                    Background="Transparent"
                                                    PreviewMouseLeftButtonDown="Grid_PreviewMouseLeftButtonDown"
                                                    Tag="{Binding Name}">
                                                    <Grid.ColumnDefinitions>
                                                        <ColumnDefinition Width="auto" />
                                                        <ColumnDefinition Width="auto" />
                                                        <ColumnDefinition Width="auto" />
                                                        <ColumnDefinition Width="*" />
                                                        <ColumnDefinition Width="auto" />
                                                    </Grid.ColumnDefinitions>
                                                    <Grid.ContextMenu>
                                                        <ContextMenu>
                                                            <MenuItem
                                                                Click="Remark"
                                                                Header="{DynamicResource Remark}"
                                                                Icon="/Resources/Pictures/remark.png" />
                                                            <MenuItem Click="HidePort" Header="{DynamicResource Hide}" />
                                                        </ContextMenu>
                                                    </Grid.ContextMenu>
                                                    <Border
                                                        Grid.Column="0"
                                                        Width="10"
                                                        Height="10"
                                                        Margin="5"
                                                        CornerRadius="10">
                                                        <Border.Style>
                                                            <Style TargetType="Border">
                                                                <Setter Property="Background" Value="Green" />
                                                                <Style.Triggers>

                                                                    <DataTrigger Binding="{Binding Connected}" Value="True">
                                                                        <Setter Property="Background" Value="Red" />
                                                                    </DataTrigger>
                                                                </Style.Triggers>
                                                            </Style>
                                                        </Border.Style>
                                                    </Border>
                                                    <TextBlock
                                                        Grid.Column="1"
                                                        MaxWidth="120"
                                                        Margin="0"
                                                        Padding="10,5"
                                                        HorizontalAlignment="Left"
                                                        VerticalAlignment="Center"
                                                        Style="{StaticResource BaseTextBlock}"
                                                        Text="{Binding Name}"
                                                        TextTrimming="WordEllipsis"
                                                        TextWrapping="WrapWithOverflow"
                                                        ToolTip="{Binding Detail}" />
                                                    <Border
                                                        Grid.Column="2"
                                                        Margin="0,0,5,0"
                                                        Padding="5,3"
                                                        VerticalAlignment="Center"
                                                        CornerRadius="4">
                                                        <Border.Style>
                                                            <Style TargetType="Border">
                                                                <Setter Property="Visibility" Value="Collapsed" />
                                                                <Style.Triggers>

                                                                    <DataTrigger Binding="{Binding PortType}" Value="Virtual">
                                                                        <Setter Property="ToolTip" Value="{DynamicResource VirtualPort}" />
                                                                        <Setter Property="Background" Value="{DynamicResource Common.HighLight.Deep.Background}" />
                                                                        <Setter Property="Visibility" Value="Visible" />
                                                                    </DataTrigger>
                                                                    <DataTrigger Binding="{Binding PortType}" Value="USBSerial">
                                                                        <Setter Property="ToolTip" Value="USB-Serial" />
                                                                        <Setter Property="Background" Value="{DynamicResource Common.HighLight.BorderBrush}" />
                                                                        <Setter Property="Visibility" Value="Visible" />
                                                                    </DataTrigger>
                                                                    <DataTrigger Binding="{Binding PortType}" Value="BLE">
                                                                        <Setter Property="ToolTip" Value="BLE" />
                                                                        <Setter Property="Background" Value="{DynamicResource Control.Disabled.Background}" />
                                                                        <Setter Property="Visibility" Value="Visible" />
                                                                    </DataTrigger>

                                                                    <DataTrigger Binding="{Binding Path=ShowPortType, Source={x:Static config:ConfigManager.Settings}, Mode=OneWay}" Value="False">
                                                                        <Setter Property="Visibility" Value="Collapsed" />
                                                                    </DataTrigger>
                                                                </Style.Triggers>
                                                            </Style>
                                                        </Border.Style>

                                                        <TextBlock Margin="0" FontSize="7">
                                                            <TextBlock.Style>
                                                                <Style BasedOn="{StaticResource BaseTextBlock}" TargetType="TextBlock">
                                                                    <Style.Triggers>
                                                                        <DataTrigger Binding="{Binding PortType}" Value="Virtual">
                                                                            <Setter Property="Text" Value="V" />
                                                                            <Setter Property="ToolTip" Value="{DynamicResource VirtualPort}" />
                                                                        </DataTrigger>
                                                                        <DataTrigger Binding="{Binding PortType}" Value="USBSerial">
                                                                            <Setter Property="Text" Value="U" />
                                                                            <Setter Property="ToolTip" Value="USB-Serial" />
                                                                        </DataTrigger>
                                                                        <DataTrigger Binding="{Binding PortType}" Value="BLE">
                                                                            <Setter Property="Text" Value="B" />
                                                                            <Setter Property="ToolTip" Value="BLE" />
                                                                        </DataTrigger>
                                                                    </Style.Triggers>
                                                                </Style>
                                                            </TextBlock.Style>
                                                        </TextBlock>
                                                    </Border>
                                                    <TextBlock
                                                        Grid.Column="3"
                                                        Margin="0"
                                                        HorizontalAlignment="Left"
                                                        VerticalAlignment="Center"
                                                        FontSize="12"
                                                        Foreground="{DynamicResource Window.Sub.Foreground}"
                                                        Style="{StaticResource BaseTextBlock}"
                                                        Text="{Binding Remark, UpdateSourceTrigger=PropertyChanged}"
                                                        TextTrimming="WordEllipsis"
                                                        TextWrapping="NoWrap" />
                                                    <Button
                                                        Grid.Column="4"
                                                        Margin="5"
                                                        HorizontalAlignment="Right"
                                                        Click="ConnectPort"
                                                        Tag="{Binding Name}">
                                                        <Button.Style>
                                                            <Style BasedOn="{StaticResource FillButton}" TargetType="Button">
                                                                <Setter Property="Content" Value="{DynamicResource Connect}" />
                                                                <Setter Property="Visibility" Value="Hidden" />
                                                                <Style.Triggers>
                                                                    <DataTrigger Binding="{Binding Connected}" Value="True">
                                                                        <Setter Property="Content" Value="{DynamicResource Disconnect}" />
                                                                        <Setter Property="Background" Value="Red" />
                                                                        <Setter Property="super:CommonExt.HoverBackground" Value="Red" />
                                                                    </DataTrigger>

                                                                    <DataTrigger Binding="{Binding Path=IsMouseOver, RelativeSource={RelativeSource AncestorType={x:Type Grid}, Mode=FindAncestor}}" Value="true">
                                                                        <Setter Property="Visibility" Value="Visible" />
                                                                    </DataTrigger>

                                                                </Style.Triggers>
                                                            </Style>
                                                        </Button.Style>
                                                    </Button>
                                                </Grid>
                                            </Border>
                                        </DataTemplate>
                                    </ListBox.ItemTemplate>
                                </ListBox>

                                <!--</Expander>-->
                                <Expander
                                    Foreground="{DynamicResource Window.Foreground}"
                                    Header="Telnet"
                                    Visibility="Collapsed">
                                    <TextBlock Text="192.168.3.1" />
                                </Expander>
                            </StackPanel>
                        </ScrollViewer>

                        <Grid Grid.Row="2">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="auto" />
                            </Grid.ColumnDefinitions>
                            <TextBlock
                                Grid.Column="0"
                                Padding="10,0"
                                VerticalAlignment="Center"
                                FontSize="15"
                                FontWeight="Bold"
                                Foreground="Gold"
                                Text="SuperCom" />


                            <super:HoverPath
                                Grid.Column="1"
                                Width="30"
                                Height="30"
                                Margin="5"
                                HorizontalAlignment="Right"
                                VerticalAlignment="Center"
                                Style="{StaticResource SettingHoverPath}">
                                <super:HoverPath.ContextMenu>
                                    <ContextMenu HorizontalOffset="-40">
                                        <MenuItem
                                            Click="OpenSetting"
                                            Header="{DynamicResource Settings}"
                                            Icon="/Resources/Pictures/setting.png" />
                                        <MenuItem Click="ShowPluginWindow" Header="{DynamicResource Plugin}" />
                                        <MenuItem
                                            Click="ShowUpgradeWindow"
                                            Header="{DynamicResource CheckUpgrade}"
                                            Icon="/Resources/Pictures/update.png" />
                                        <MenuItem
                                            Click="ShowAbout"
                                            Header="{DynamicResource About}"
                                            Icon="/Resources/Pictures/about.png" />
                                    </ContextMenu>
                                </super:HoverPath.ContextMenu>
                            </super:HoverPath>


                        </Grid>
                    </Grid>
                </Border>
                <GridSplitter
                    Grid.Column="1"
                    Width="4"
                    HorizontalAlignment="Left"
                    Panel.ZIndex="10"
                    Style="{StaticResource HoverSpliter}" />

                <Popup
                    x:Name="editSendCommandPopup"
                    Width="300"
                    Height="400"
                    Margin="0,0,700,0"
                    AllowsTransparency="True"
                    HorizontalOffset="-150"
                    Placement="Mouse"
                    PopupAnimation="Fade"
                    StaysOpen="True"
                    VerticalOffset="-80">
                    <Grid Margin="5">
                        <Border
                            Margin="5"
                            Background="{DynamicResource Menu.Background}"
                            CornerRadius="5"
                            Effect="{StaticResource PopupDropShadowEffect}" />
                        <Grid Margin="5">
                            <Grid.RowDefinitions>
                                <RowDefinition Height="auto" />
                                <RowDefinition Height="*" />
                                <RowDefinition Height="auto" />
                            </Grid.RowDefinitions>
                            <TextBlock
                                Margin="5,20,5,5"
                                FontWeight="Bold"
                                Style="{StaticResource BaseTextBlock}"
                                Text="{DynamicResource EditCommand}" />

                            <DockPanel
                                Grid.Row="1"
                                Margin="10"
                                LastChildFill="True">
                                <DockPanel DockPanel.Dock="Top" LastChildFill="True">
                                    <TextBlock
                                        MinWidth="50"
                                        Style="{StaticResource BaseTextBlock}"
                                        Text="{DynamicResource Order}" />
                                    <super:SearchBox Name="editTextBoxOrder" Margin="0,5" />
                                </DockPanel>
                                <DockPanel
                                    VerticalAlignment="Top"
                                    DockPanel.Dock="Top"
                                    LastChildFill="True">
                                    <TextBlock
                                        MinWidth="50"
                                        Style="{StaticResource BaseTextBlock}"
                                        Text="{DynamicResource Title}" />
                                    <super:SearchBox Name="editTextBoxName" Margin="0,5" />
                                </DockPanel>
                                <DockPanel
                                    VerticalAlignment="Top"
                                    DockPanel.Dock="Top"
                                    LastChildFill="True">
                                    <TextBlock
                                        MinWidth="50"
                                        Style="{StaticResource BaseTextBlock}"
                                        Text="{DynamicResource Delay}" />

                                    <super:SearchBox Name="editTextBoxDelay" Margin="0,5" />

                                </DockPanel>

                                <StackPanel DockPanel.Dock="Top" Orientation="Horizontal">



                                    <TextBlock
                                        MinWidth="50"
                                        HorizontalAlignment="Left"
                                        Style="{StaticResource BaseTextBlock}"
                                        Text="{DynamicResource Command}" />

                                    <super:HoverPath
                                        Grid.Column="0"
                                        Margin="0,0,5,0"
                                        Click="CopyCommand"
                                        Style="{StaticResource CopyHoverPath}" />


                                </StackPanel>
                                <Border
                                    Margin="15,5,5,5"
                                    Padding="5"
                                    Background="{DynamicResource Window.Title.Background}"
                                    BorderThickness="1"
                                    CornerRadius="3">
                                    <Border.Style>
                                        <Style TargetType="Border">
                                            <Style.Triggers>
                                                <DataTrigger Binding="{Binding ElementName=editTextBoxCommand, Path=IsFocused}" Value="True">
                                                    <Setter Property="BorderBrush" Value="{DynamicResource Button.Selected.BorderBrush}" />
                                                </DataTrigger>
                                            </Style.Triggers>
                                        </Style>
                                    </Border.Style>
                                    <TextBox
                                        Name="editTextBoxCommand"
                                        Padding="2,0,0,0"
                                        HorizontalAlignment="Stretch"
                                        VerticalContentAlignment="Top"
                                        AcceptsReturn="False"
                                        Background="Transparent"
                                        ContextMenu="{StaticResource TextBoxContextMenu}"
                                        FontSize="12"
                                        Style="{StaticResource BaseTextBox}"
                                        Text=""
                                        TextAlignment="Left"
                                        TextWrapping="Wrap" />
                                </Border>

                            </DockPanel>

                            <StackPanel
                                Grid.Row="2"
                                Margin="5"
                                HorizontalAlignment="Center"
                                Orientation="Horizontal">
                                <Button
                                    Margin="5"
                                    Click="EditCommandConfirm"
                                    Content="{DynamicResource Confirm}"
                                    Style="{StaticResource ButtonPrimary}" />
                                <Button
                                    Margin="5"
                                    Click="EditCommandCancel"
                                    Content="{DynamicResource Cancel}"
                                    Style="{StaticResource ButtonDanger}" />
                            </StackPanel>
                        </Grid>

                    </Grid>
                </Popup>

                <Popup
                    x:Name="hexTransPopup"
                    Grid.ColumnSpan="3"
                    Width="300"
                    Height="auto"
                    Margin="0,0,700,0"
                    AllowsTransparency="True"
                    HorizontalOffset="-150"
                    Placement="Mouse"
                    PopupAnimation="Fade"
                    StaysOpen="False"
                    VerticalOffset="-80">
                    <Grid Margin="5">
                        <Border
                            Margin="5"
                            Background="{DynamicResource Menu.Background}"
                            CornerRadius="5"
                            Effect="{StaticResource PopupDropShadowEffect}" />
                        <Grid Margin="20">
                            <Grid.RowDefinitions>
                                <RowDefinition Height="auto" />
                                <RowDefinition Height="auto" />
                                <RowDefinition Height="auto" />
                                <RowDefinition Height="auto" />
                                <RowDefinition Height="auto" />
                            </Grid.RowDefinitions>

                            <StackPanel Orientation="Horizontal">
                                <TextBlock
                                    Grid.Row="0"
                                    VerticalAlignment="Center"
                                    FontWeight="Bold"
                                    Text="HEX" />
                                <super:Switch
                                    Name="HexToStrSwitch"
                                    Height="16"
                                    Margin="20,0,5,0"
                                    VerticalAlignment="Center"
                                    BorderBrush="{DynamicResource Window.Title.Background}"
                                    Click="Switch_Click" />
                                <TextBlock
                                    Margin="0,0,10,0"
                                    VerticalAlignment="Center"
                                    FontSize="12"
                                    Style="{StaticResource BaseTextBlock}"
                                    Text="{DynamicResource Upper}" />
                                <Button
                                    Margin="5,2"
                                    Padding="4"
                                    VerticalAlignment="Center"
                                    Click="ClearHexSpace"
                                    Content="{DynamicResource RemoveSpace}"
                                    FontSize="10" />


                            </StackPanel>
                            <ToggleButton
                                Width="auto"
                                Height="auto"
                                Margin="5,0"
                                Padding="2,2,4,2"
                                HorizontalAlignment="Right"
                                VerticalAlignment="Center"
                                Background="Transparent"
                                Click="SetStayOpenStatus"
                                Style="{StaticResource FlatToggleButton}">
                                <Viewbox
                                    Width="15"
                                    Height="auto"
                                    VerticalAlignment="Center">
                                    <Path Data="M187.690667 874.709333h-0.277334a37.504 37.504 0 0 1-26.602666-11.264 37.845333 37.845333 0 0 1-3.904-49.877333l166.762666-229.76-125.013333-125.056a38.229333 38.229333 0 0 1-6.058667-46.336 140.8 140.8 0 0 1 53.504-45.674667 154.24 154.24 0 0 1 67.84-15.552 161.792 161.792 0 0 1 51.84 8.533334l6.4 0.661333c5.781333 0.405333 10.901333 0.981333 15.701334 1.749333a161.877333 161.877333 0 0 0 104.277333-47.253333 144.874667 144.874667 0 0 0 58.474667-90.346667c0-5.802667 0-11.904-0.234667-17.664a80.576 80.576 0 0 1 15.658667-74.858666A84.949333 84.949333 0 0 1 626.858667 106.666667a85.525333 85.525333 0 0 1 54.08 19.328l1.962666 1.941333c18.88 18.432 207.253333 206.933333 209.066667 208.746667A85.930667 85.930667 0 0 1 917.333333 397.888a85.973333 85.973333 0 0 1-25.6 61.205333 67.456 67.456 0 0 1-46.549333 16.874667 199.210667 199.210667 0 0 1-30.229333-3.008 226.176 226.176 0 0 0-15.701334-0.362667h-1.493333a115.605333 115.605333 0 0 0-77.930667 45.205334 210.752 210.752 0 0 0-59.456 118.976c0.917333 7.850667 2.56 21.333333 2.858667 23.125333a144.298667 144.298667 0 0 1-57.258667 165.056 38.229333 38.229333 0 0 1-20.138666 5.717333 38.058667 38.058667 0 0 1-27.093334-11.2l-123.562666-123.733333L209.92 866.986667a36.266667 36.266667 0 0 1-22.229333 7.722666z" Fill="{DynamicResource Window.Foreground}" />
                                </Viewbox>
                            </ToggleButton>

                            <Border
                                Grid.Row="1"
                                Margin="0,10"
                                Padding="5"
                                Background="{DynamicResource Window.Title.Background}"
                                CornerRadius="5">
                                <TextBox
                                    Name="HexTextBox"
                                    Grid.Row="1"
                                    MaxHeight="100"
                                    HorizontalAlignment="Stretch"
                                    Background="Transparent"
                                    ContextMenu="{StaticResource TextBoxContextMenu}"
                                    Style="{StaticResource MultiLineTextBox}"
                                    VerticalScrollBarVisibility="Auto" />
                            </Border>



                            <TextBlock
                                Grid.Row="2"
                                FontWeight="Bold"
                                Text="{DynamicResource String}" />

                            <Border
                                Grid.Row="3"
                                Margin="0,10,0,0"
                                Padding="5"
                                Background="{DynamicResource Window.Title.Background}"
                                CornerRadius="5">
                                <TextBox
                                    Name="StrTextBox"
                                    Grid.Row="1"
                                    MaxHeight="100"
                                    HorizontalAlignment="Stretch"
                                    Background="Transparent"
                                    ContextMenu="{StaticResource TextBoxContextMenu}"
                                    Style="{StaticResource MultiLineTextBox}"
                                    VerticalScrollBarVisibility="Auto" />
                            </Border>

                            <WrapPanel
                                Grid.Row="4"
                                Margin="0,10"
                                Orientation="Horizontal">
                                <Button
                                    Margin="0,0,5,0"
                                    Click="HexToStr"
                                    Content="Hex =&gt; Str"
                                    Style="{StaticResource ButtonPrimary}" />
                                <Button
                                    Margin="5,0"
                                    Click="StrToHex"
                                    Content="Str =&gt; Hex"
                                    Style="{StaticResource ButtonPrimary}" />
                            </WrapPanel>

                        </Grid>

                    </Grid>
                </Popup>
                <Popup
                    x:Name="timeTransPopup"
                    Grid.ColumnSpan="3"
                    Width="330"
                    Height="auto"
                    Margin="0,0,670,0"
                    AllowsTransparency="True"
                    HorizontalOffset="-150"
                    Placement="Mouse"
                    PopupAnimation="Fade"
                    StaysOpen="False"
                    VerticalOffset="-120">
                    <Grid Margin="5">
                        <Border
                            Margin="5"
                            Background="{DynamicResource Menu.Background}"
                            CornerRadius="5"
                            Effect="{StaticResource PopupDropShadowEffect}" />
                        <Grid Margin="20">
                            <Grid.RowDefinitions>
                                <RowDefinition Height="auto" />
                                <RowDefinition Height="auto" />
                                <RowDefinition Height="auto" />
                                <RowDefinition Height="auto" />
                                <RowDefinition Height="auto" />
                            </Grid.RowDefinitions>

                            <StackPanel Orientation="Horizontal">
                                <TextBlock
                                    Grid.Row="0"
                                    VerticalAlignment="Center"
                                    FontWeight="Bold"
                                    Text="{DynamicResource TimeStamp}" />

                                <ComboBox
                                    Name="TimeComboBox"
                                    MinWidth="100"
                                    Margin="20,0"
                                    FontSize="10"
                                    SelectedIndex="0"
                                    Style="{StaticResource BorderComboBox}">
                                    <ComboBoxItem Content="{DynamicResource SecondUnit}" />
                                    <ComboBoxItem Content="{DynamicResource MilliSecondUnit}" />
                                </ComboBox>


                            </StackPanel>

                            <ToggleButton
                                Width="auto"
                                Height="auto"
                                Margin="5,0"
                                Padding="2,2,4,2"
                                HorizontalAlignment="Right"
                                VerticalAlignment="Center"
                                Background="Transparent"
                                Click="SetStayOpenStatus"
                                Style="{StaticResource FlatToggleButton}">
                                <Viewbox
                                    Width="15"
                                    Height="auto"
                                    VerticalAlignment="Center">
                                    <Path Data="M187.690667 874.709333h-0.277334a37.504 37.504 0 0 1-26.602666-11.264 37.845333 37.845333 0 0 1-3.904-49.877333l166.762666-229.76-125.013333-125.056a38.229333 38.229333 0 0 1-6.058667-46.336 140.8 140.8 0 0 1 53.504-45.674667 154.24 154.24 0 0 1 67.84-15.552 161.792 161.792 0 0 1 51.84 8.533334l6.4 0.661333c5.781333 0.405333 10.901333 0.981333 15.701334 1.749333a161.877333 161.877333 0 0 0 104.277333-47.253333 144.874667 144.874667 0 0 0 58.474667-90.346667c0-5.802667 0-11.904-0.234667-17.664a80.576 80.576 0 0 1 15.658667-74.858666A84.949333 84.949333 0 0 1 626.858667 106.666667a85.525333 85.525333 0 0 1 54.08 19.328l1.962666 1.941333c18.88 18.432 207.253333 206.933333 209.066667 208.746667A85.930667 85.930667 0 0 1 917.333333 397.888a85.973333 85.973333 0 0 1-25.6 61.205333 67.456 67.456 0 0 1-46.549333 16.874667 199.210667 199.210667 0 0 1-30.229333-3.008 226.176 226.176 0 0 0-15.701334-0.362667h-1.493333a115.605333 115.605333 0 0 0-77.930667 45.205334 210.752 210.752 0 0 0-59.456 118.976c0.917333 7.850667 2.56 21.333333 2.858667 23.125333a144.298667 144.298667 0 0 1-57.258667 165.056 38.229333 38.229333 0 0 1-20.138666 5.717333 38.058667 38.058667 0 0 1-27.093334-11.2l-123.562666-123.733333L209.92 866.986667a36.266667 36.266667 0 0 1-22.229333 7.722666z" Fill="{DynamicResource Window.Foreground}" />
                                </Viewbox>
                            </ToggleButton>

                            <Border
                                Grid.Row="1"
                                Margin="0,10"
                                Padding="5"
                                Background="{DynamicResource Window.Title.Background}"
                                CornerRadius="5">
                                <TextBox
                                    Name="TimeStampTextBox"
                                    Grid.Row="1"
                                    MaxHeight="100"
                                    HorizontalAlignment="Stretch"
                                    Background="Transparent"
                                    ContextMenu="{StaticResource TextBoxContextMenu}"
                                    Style="{StaticResource MultiLineTextBox}"
                                    VerticalScrollBarVisibility="Auto" />
                            </Border>



                            <TextBlock
                                Grid.Row="2"
                                FontWeight="Bold"
                                Text="{DynamicResource BeijingTime}" />

                            <Border
                                Grid.Row="3"
                                Margin="0,10,0,0"
                                Padding="5"
                                Background="{DynamicResource Window.Title.Background}"
                                CornerRadius="5">
                                <TextBox
                                    Name="LocalTimeTextBox"
                                    Grid.Row="1"
                                    MaxHeight="100"
                                    HorizontalAlignment="Stretch"
                                    Background="Transparent"
                                    ContextMenu="{StaticResource TextBoxContextMenu}"
                                    Style="{StaticResource MultiLineTextBox}"
                                    VerticalScrollBarVisibility="Auto" />
                            </Border>

                            <WrapPanel
                                Grid.Row="4"
                                Margin="0,10"
                                Orientation="Horizontal">
                                <Button
                                    Margin="0,0,5,0"
                                    Click="TimeStampToLocalTime"
                                    Content="时间戳 =&gt; 北京时间"
                                    Style="{StaticResource ButtonPrimary}" />
                                <Button
                                    Margin="5,0"
                                    Click="LocalTimeToTimeStamp"
                                    Content="北京时间 =&gt; 时间戳"
                                    Style="{StaticResource ButtonPrimary}" />
                            </WrapPanel>

                        </Grid>

                    </Grid>
                </Popup>


                <Grid Grid.Column="2">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="auto" />
                        <RowDefinition Height="auto" />
                        <RowDefinition Height="*" />
                    </Grid.RowDefinitions>

                    <super:NoticeViewer x:Name="noticeViewer" Grid.Row="0" />

                    <StackPanel
                        Grid.RowSpan="3"
                        HorizontalAlignment="Center"
                        VerticalAlignment="Center"
                        Orientation="Vertical"
                        Visibility="{Binding ShowSoft, Converter={StaticResource BoolToVisibilityConverter}}">

                        <Image
                            Grid.Row="0"
                            Height="128"
                            Margin="10"
                            Source="pack://application:,,,/Resources/Ico/ICON_256.png">
                            <Image.Effect>
                                <DropShadowEffect
                                    BlurRadius="4"
                                    Direction="315"
                                    Opacity="1"
                                    ShadowDepth="5"
                                    Color="Black" />
                            </Image.Effect>
                        </Image>
                        <TextBlock
                            Grid.Row="1"
                            FontSize="25"
                            Style="{StaticResource BaseTextBlock}"
                            Text="{DynamicResource WelComeUseApp}">
                            <TextBlock.Effect>
                                <DropShadowEffect
                                    BlurRadius="4"
                                    Direction="315"
                                    Opacity="1"
                                    ShadowDepth="5"
                                    Color="Black" />
                            </TextBlock.Effect>
                        </TextBlock>
                        <TextBlock
                            Grid.Row="2"
                            FontSize="15"
                            Foreground="{DynamicResource Window.Sub.Foreground}"
                            Style="{StaticResource BaseTextBlock}"
                            Text="@SuperStudio Copyright © 2022">
                            <TextBlock.Effect>
                                <DropShadowEffect
                                    BlurRadius="4"
                                    Direction="315"
                                    Opacity="1"
                                    ShadowDepth="5"
                                    Color="Black" />
                            </TextBlock.Effect>
                        </TextBlock>
                    </StackPanel>

                    <!--  选项 tabitem 栏  -->
                    <ScrollViewer
                        Grid.Row="1"
                        HorizontalScrollBarVisibility="Auto"
                        PreviewMouseWheel="PortTab_PreviewMouseWheel"
                        VerticalScrollBarVisibility="Hidden">
                        <ItemsControl Name="tabItemsControl" ItemsSource="{Binding PortTabItems}">
                            <ItemsControl.ItemsPanel>
                                <ItemsPanelTemplate>
                                    <StackPanel Orientation="Horizontal" />
                                </ItemsPanelTemplate>
                            </ItemsControl.ItemsPanel>
                            <ItemsControl.ItemTemplate>
                                <DataTemplate>
                                    <Border
                                        Height="35"
                                        MinWidth="150"
                                        BorderThickness="1"
                                        ContextMenuOpening="ContextMenu_ContextMenuOpening"
                                        Cursor="Hand"
                                        PreviewMouseLeftButtonDown="BeginDragTabItem"
                                        PreviewMouseLeftButtonUp="SetPortSelected"
                                        PreviewMouseMove="Border_PreviewMouseMove"
                                        Tag="{Binding Name}">
                                        <Border.Style>
                                            <Style TargetType="Border">
                                                <Setter Property="Background" Value="{DynamicResource TabItem.Background}" />
                                                <Style.Triggers>
                                                    <DataTrigger Binding="{Binding Selected}" Value="True">
                                                        <Setter Property="Background" Value="{DynamicResource ListBoxItem.Selected.Active.Background}" />
                                                    </DataTrigger>
                                                </Style.Triggers>
                                            </Style>
                                        </Border.Style>
                                        <Border.ContextMenu>
                                            <ContextMenu>
                                                <MenuItem
                                                    Name="_CloseOpenAllMenuItem"
                                                    Click="CloseAllConnectPort"
                                                    Header="{DynamicResource DisConnectAll}" />
                                                <Separator />
                                                <MenuItem Click="CloseCurrentPort" Header="{DynamicResource Close}" />
                                                <MenuItem Click="CloseOtherPort" Header="{DynamicResource CloseOther}" />
                                                <MenuItem Click="CloseAllLeftPort" Header="{DynamicResource CloseAllLeft}" />
                                                <MenuItem Click="CloseAllRightPort" Header="{DynamicResource CloseAllRight}" />
                                                <MenuItem Click="CloseAllPorts" Header="{DynamicResource CloseAllPort}" />
                                                <Separator />
                                                <MenuItem Click="MoveToFirst" Header="{DynamicResource MoveToFirst}" />
                                                <MenuItem Click="MoveToLast" Header="{DynamicResource MoveToLast}" />
                                                <Separator />
                                                <MenuItem
                                                    Click="PinPort"
                                                    Header="{DynamicResource Pin}"
                                                    IsCheckable="True"
                                                    IsChecked="{Binding Pinned, Mode=OneWay}" />
                                                <Separator />
                                                <MenuItem
                                                    Click="Remark"
                                                    Header="{DynamicResource Remark}"
                                                    Icon="/Resources/Pictures/remark.png" />
                                            </ContextMenu>
                                        </Border.ContextMenu>
                                        <Grid>
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="auto" />
                                                <ColumnDefinition Width="*" />
                                                <ColumnDefinition Width="auto" />
                                                <ColumnDefinition Width="auto" />
                                                <ColumnDefinition Width="auto" />
                                            </Grid.ColumnDefinitions>
                                            <Border
                                                Grid.Column="0"
                                                Width="10"
                                                Height="10"
                                                Margin="5"
                                                CornerRadius="10">
                                                <Border.Style>
                                                    <Style TargetType="Border">
                                                        <Setter Property="Background" Value="Green" />
                                                        <Style.Triggers>

                                                            <DataTrigger Binding="{Binding Connected}" Value="True">
                                                                <Setter Property="Background" Value="Red" />
                                                            </DataTrigger>
                                                        </Style.Triggers>
                                                    </Style>
                                                </Border.Style>
                                            </Border>
                                            <TextBlock
                                                Grid.Column="1"
                                                MaxWidth="120"
                                                Margin="0"
                                                Padding="10,5"
                                                HorizontalAlignment="Left"
                                                VerticalAlignment="Center"
                                                Style="{StaticResource BaseTextBlock}"
                                                Text="{Binding Name}"
                                                TextTrimming="WordEllipsis"
                                                TextWrapping="WrapWithOverflow"
                                                ToolTip="{Binding Detail}" />
                                            <Border
                                                Grid.Column="2"
                                                Margin="0,0,5,0"
                                                Padding="5,3"
                                                VerticalAlignment="Center"
                                                CornerRadius="4">
                                                <Border.Style>
                                                    <Style TargetType="Border">
                                                        <Setter Property="Visibility" Value="Collapsed" />
                                                        <Style.Triggers>

                                                            <DataTrigger Binding="{Binding PortType}" Value="Virtual">
                                                                <Setter Property="ToolTip" Value="{DynamicResource VirtualPort}" />
                                                                <Setter Property="Background" Value="{DynamicResource Common.HighLight.Deep.Background}" />
                                                                <Setter Property="Visibility" Value="Visible" />
                                                            </DataTrigger>
                                                            <DataTrigger Binding="{Binding PortType}" Value="USBSerial">
                                                                <Setter Property="ToolTip" Value="USB-Serial" />
                                                                <Setter Property="Background" Value="{DynamicResource Common.HighLight.BorderBrush}" />
                                                                <Setter Property="Visibility" Value="Visible" />
                                                            </DataTrigger>
                                                            <DataTrigger Binding="{Binding PortType}" Value="BLE">
                                                                <Setter Property="ToolTip" Value="BLE" />
                                                                <Setter Property="Background" Value="{DynamicResource Control.Disabled.Background}" />
                                                                <Setter Property="Visibility" Value="Visible" />
                                                            </DataTrigger>

                                                            <DataTrigger Binding="{Binding Path=ShowPortType, Source={x:Static config:ConfigManager.Settings}, Mode=OneWay}" Value="False">
                                                                <Setter Property="Visibility" Value="Collapsed" />
                                                            </DataTrigger>
                                                        </Style.Triggers>
                                                    </Style>
                                                </Border.Style>

                                                <TextBlock Margin="0" FontSize="7">
                                                    <TextBlock.Style>
                                                        <Style BasedOn="{StaticResource BaseTextBlock}" TargetType="TextBlock">
                                                            <Style.Triggers>
                                                                <DataTrigger Binding="{Binding PortType}" Value="Virtual">
                                                                    <Setter Property="Text" Value="V" />
                                                                    <Setter Property="ToolTip" Value="{DynamicResource VirtualPort}" />
                                                                </DataTrigger>
                                                                <DataTrigger Binding="{Binding PortType}" Value="USBSerial">
                                                                    <Setter Property="Text" Value="U" />
                                                                    <Setter Property="ToolTip" Value="USB-Serial" />
                                                                </DataTrigger>
                                                                <DataTrigger Binding="{Binding PortType}" Value="BLE">
                                                                    <Setter Property="Text" Value="B" />
                                                                    <Setter Property="ToolTip" Value="BLE" />
                                                                </DataTrigger>
                                                            </Style.Triggers>
                                                        </Style>
                                                    </TextBlock.Style>
                                                </TextBlock>
                                            </Border>
                                            <TextBlock
                                                Grid.Column="3"
                                                MaxWidth="100"
                                                Margin="0"
                                                HorizontalAlignment="Left"
                                                VerticalAlignment="Center"
                                                FontSize="12"
                                                Foreground="{DynamicResource Window.Sub.Foreground}"
                                                Style="{StaticResource BaseTextBlock}"
                                                Text="{Binding Remark}"
                                                TextTrimming="WordEllipsis"
                                                TextWrapping="NoWrap" />

                                            <Grid Grid.Column="4">
                                                <super:HoverPath
                                                    Width="20"
                                                    Height="20"
                                                    Margin="4"
                                                    VerticalAlignment="Center"
                                                    Panel.ZIndex="2"
                                                    PathPadding="5 5 6 5"
                                                    PreviewMouseLeftButtonDown="PinTabItem"
                                                    Style="{StaticResource PinHoverPath}"
                                                    Visibility="{Binding Pinned, Converter={StaticResource BoolToVisibilityConverter}}" />


                                                <super:HoverPath
                                                    Width="20"
                                                    Height="20"
                                                    Margin="4"
                                                    VerticalAlignment="Center"
                                                    PreviewMouseLeftButtonDown="CloseTabItem"
                                                    Style="{StaticResource CloseExHoverPath}"
                                                    Visibility="{Binding Pinned, Converter={StaticResource BoolToOppositeVisibilityConverter}}" />

                                            </Grid>


                                        </Grid>
                                    </Border>
                                </DataTemplate>
                            </ItemsControl.ItemTemplate>
                        </ItemsControl>
                    </ScrollViewer>
                    <ItemsControl
                        Name="itemsControl"
                        Grid.Row="2"
                        Background="Transparent"
                        ItemsSource="{Binding PortTabItems}">
                        <ItemsControl.ItemsPanel>
                            <ItemsPanelTemplate>
                                <Grid />
                            </ItemsPanelTemplate>
                        </ItemsControl.ItemsPanel>



                        <ItemsControl.ItemTemplate>
                            <DataTemplate>
                                <Grid
                                    Name="baseGrid"
                                    PreviewKeyDown="onPreviewKeyDown"
                                    Tag="{Binding Name}"
                                    Visibility="{Binding Selected, Converter={StaticResource BoolToVisibilityConverter}}">
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="*" MinHeight="100" />
                                        <RowDefinition Height="5" />
                                        <RowDefinition Height="auto" MaxHeight="300" />
                                    </Grid.RowDefinitions>


                                    <Grid
                                        Name="rootGrid"
                                        Grid.Row="0"
                                        Tag="{Binding Name}">
                                        <Grid.RowDefinitions>
                                            <RowDefinition Height="*" />
                                            <RowDefinition Height="auto" />
                                        </Grid.RowDefinitions>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="*" />
                                            <ColumnDefinition Width="auto" />
                                        </Grid.ColumnDefinitions>
                                        <Border
                                            Grid.Row="0"
                                            Grid.Column="0"
                                            Margin="0,0,5,0"
                                            Padding="10"
                                            Background="{DynamicResource TabItem.Background}"
                                            BorderThickness="1"
                                            CornerRadius="3"
                                            PreviewMouseWheel="Border_PreviewMouseWheel">
                                            <avalonEdit:TextEditor
                                                Name="textEditor"
                                                Background="Transparent"
                                                BorderThickness="0"
                                                ContextMenu="{StaticResource TextEditorContextMenu}"
                                                FontFamily="微软雅黑"
                                                FontSize="{Binding SerialPort.TextFontSize, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                                Foreground="{DynamicResource Window.Foreground}"
                                                GotFocus="textBox_GotFocus"
                                                IsReadOnly="True"
                                                LostFocus="textBox_LostFocus"
                                                PreviewMouseWheel="textEditor_PreviewMouseWheel"
                                                SyntaxHighlighting="ComLog"
                                                WordWrap="{Binding AutoWrap, Source={x:Static config:ConfigManager.Main}, Mode=OneWay}" />
                                        </Border>

                                        <super:GoToTop
                                            Grid.Row="0"
                                            Margin="30,20"
                                            HorizontalAlignment="Right"
                                            VerticalAlignment="Bottom"
                                            Panel.ZIndex="99"
                                            OnGoToBottom="GotoBottom"
                                            OnGoToTop="GotoTop" />

                                        <Border
                                            Grid.Row="1"
                                            Margin="0,5,5,0"
                                            Padding="0,3"
                                            Background="{DynamicResource Window.Side.Background}"
                                            CornerRadius="5"
                                            Tag="{Binding Name}">
                                            <StackPanel Orientation="Horizontal">
                                                <Button
                                                    Grid.Column="1"
                                                    MinWidth="70"
                                                    MinHeight="30"
                                                    Margin="5,0"
                                                    HorizontalAlignment="Right"
                                                    VerticalAlignment="Center"
                                                    Click="ConnectPort"
                                                    FontWeight="Bold"
                                                    Tag="{Binding Name}">
                                                    <Button.Style>
                                                        <Style BasedOn="{StaticResource FillButton}" TargetType="Button">
                                                            <Setter Property="Content" Value="{DynamicResource Connect}" />
                                                            <Setter Property="Opacity" Value="1" />

                                                            <Style.Triggers>
                                                                <DataTrigger Binding="{Binding Connected}" Value="True">
                                                                    <Setter Property="Content" Value="{DynamicResource Disconnect}" />
                                                                    <Setter Property="Background" Value="Red" />
                                                                    <Setter Property="super:CommonExt.HoverBackground" Value="Red" />
                                                                </DataTrigger>
                                                                <Trigger Property="IsMouseOver" Value="True">
                                                                    <Setter Property="Opacity" Value="0.7" />
                                                                </Trigger>


                                                            </Style.Triggers>
                                                        </Style>
                                                    </Button.Style>
                                                </Button>
                                                <Button
                                                    MinWidth="70"
                                                    MinHeight="30"
                                                    Margin="5,0"
                                                    VerticalAlignment="Center"
                                                    super:CommonExt.CornerRadius="5"
                                                    Click="ClearData"
                                                    Content="{DynamicResource ClearText}"
                                                    Style="{StaticResource ButtonDanger}"
                                                    ToolTip="{DynamicResource ClearWindowText}" />
                                                <ToggleButton
                                                    Name="pinToggleButton"
                                                    Width="25"
                                                    Height="25"
                                                    Margin="5,0"
                                                    Padding="2,2,4,2"
                                                    HorizontalAlignment="Right"
                                                    VerticalAlignment="Center"
                                                    Background="Transparent"
                                                    Checked="pinToggleButton_Checked"
                                                    IsChecked="{Binding FixedText, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                                    Style="{StaticResource FlatToggleButton}"
                                                    ToolTip="{DynamicResource PinOrScroll}">
                                                    <Viewbox
                                                        Width="16"
                                                        Height="auto"
                                                        VerticalAlignment="Center">
                                                        <Path Data="M187.690667 874.709333h-0.277334a37.504 37.504 0 0 1-26.602666-11.264 37.845333 37.845333 0 0 1-3.904-49.877333l166.762666-229.76-125.013333-125.056a38.229333 38.229333 0 0 1-6.058667-46.336 140.8 140.8 0 0 1 53.504-45.674667 154.24 154.24 0 0 1 67.84-15.552 161.792 161.792 0 0 1 51.84 8.533334l6.4 0.661333c5.781333 0.405333 10.901333 0.981333 15.701334 1.749333a161.877333 161.877333 0 0 0 104.277333-47.253333 144.874667 144.874667 0 0 0 58.474667-90.346667c0-5.802667 0-11.904-0.234667-17.664a80.576 80.576 0 0 1 15.658667-74.858666A84.949333 84.949333 0 0 1 626.858667 106.666667a85.525333 85.525333 0 0 1 54.08 19.328l1.962666 1.941333c18.88 18.432 207.253333 206.933333 209.066667 208.746667A85.930667 85.930667 0 0 1 917.333333 397.888a85.973333 85.973333 0 0 1-25.6 61.205333 67.456 67.456 0 0 1-46.549333 16.874667 199.210667 199.210667 0 0 1-30.229333-3.008 226.176 226.176 0 0 0-15.701334-0.362667h-1.493333a115.605333 115.605333 0 0 0-77.930667 45.205334 210.752 210.752 0 0 0-59.456 118.976c0.917333 7.850667 2.56 21.333333 2.858667 23.125333a144.298667 144.298667 0 0 1-57.258667 165.056 38.229333 38.229333 0 0 1-20.138666 5.717333 38.058667 38.058667 0 0 1-27.093334-11.2l-123.562666-123.733333L209.92 866.986667a36.266667 36.266667 0 0 1-22.229333 7.722666z" Fill="{DynamicResource Window.Foreground}" />
                                                    </Viewbox>
                                                </ToggleButton>

                                                <super:HoverPath
                                                    Click="OpenPath"
                                                    Style="{StaticResource FolderHoverPath}"
                                                    ToolTip="{DynamicResource OpenLogDir}" />
                                                <super:HoverPath
                                                    Click="OpenByDefaultApp"
                                                    Style="{StaticResource OpenTextHoverPath}"
                                                    ToolTip="{DynamicResource OpenLogByDefaultApp}" />

                                                <CheckBox
                                                    Margin="10"
                                                    VerticalAlignment="Center"
                                                    Content="{DynamicResource AddTimeStamp}"
                                                    FontSize="15"
                                                    IsChecked="{Binding AddTimeStamp, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                                    Style="{StaticResource NormalCheckBox}" />

                                                <ToggleButton
                                                    MinWidth="40"
                                                    Margin="5,0"
                                                    Padding="5"
                                                    HorizontalAlignment="Left"
                                                    VerticalAlignment="Center"
                                                    IsChecked="{Binding RecvShowHex, Mode=TwoWay}"
                                                    Opacity="0.8">
                                                    <ToggleButton.Style>
                                                        <Style BasedOn="{StaticResource FlatToggleButton}" TargetType="ToggleButton">
                                                            <Setter Property="Content" Value="STR" />
                                                            <Setter Property="ToolTip" Value="{DynamicResource ModeShowString}" />
                                                            <Style.Triggers>
                                                                <Trigger Property="IsChecked" Value="True">
                                                                    <Setter Property="Content" Value="HEX" />
                                                                    <Setter Property="ToolTip" Value="{DynamicResource ModeShowHex}" />
                                                                </Trigger>
                                                            </Style.Triggers>
                                                        </Style>
                                                    </ToggleButton.Style>
                                                </ToggleButton>

                                                <Button
                                                    Margin="5,0"
                                                    Click="SaveToNewFile"
                                                    Content="{DynamicResource LogSaveAs}" />

                                                <StackPanel
                                                    Grid.Column="1"
                                                    Margin="10,0"
                                                    Orientation="Horizontal">

                                                    <TextBox
                                                        MinWidth="100"
                                                        Background="Transparent"
                                                        Foreground="{DynamicResource Window.Sub.Foreground}"
                                                        Style="{StaticResource ReadOnlyTextBox}"
                                                        Text="{Binding RX, Mode=OneWay, StringFormat=RX {0}}"
                                                        TextWrapping="NoWrap" />

                                                    <TextBox
                                                        MinWidth="100"
                                                        Background="Transparent"
                                                        Foreground="{DynamicResource Window.Sub.Foreground}"
                                                        Style="{StaticResource ReadOnlyTextBox}"
                                                        Text="{Binding TX, Mode=OneWay, StringFormat=TX {0}}"
                                                        TextWrapping="NoWrap" />
                                                </StackPanel>
                                            </StackPanel>
                                        </Border>

                                        <Grid
                                            Grid.Row="0"
                                            Grid.Column="1"
                                            HorizontalAlignment="Right"
                                            Visibility="Collapsed">
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="auto" />
                                                <ColumnDefinition Width="auto" />
                                            </Grid.ColumnDefinitions>

                                            <Grid />

                                            <StackPanel Orientation="Vertical" Visibility="Collapsed">
                                                <ToggleButton
                                                    Margin="0"
                                                    super:CommonExt.CornerRadius="0"
                                                    BorderBrush="{DynamicResource Button.Selected.BorderBrush}"
                                                    BorderThickness="0,0,2,0"
                                                    SnapsToDevicePixels="True"
                                                    Style="{StaticResource FlatToggleButton}">
                                                    <ToggleButton.Content>
                                                        <StackPanel Orientation="Vertical">
                                                            <TextBlock
                                                                Margin="0"
                                                                FontSize="10"
                                                                Style="{StaticResource BaseTextBlock}"
                                                                Text="过" />
                                                            <TextBlock
                                                                Margin="0"
                                                                FontSize="10"
                                                                Style="{StaticResource BaseTextBlock}"
                                                                Text="滤" />
                                                            <TextBlock
                                                                Margin="0"
                                                                FontSize="10"
                                                                Style="{StaticResource BaseTextBlock}"
                                                                Text="器" />
                                                        </StackPanel>
                                                    </ToggleButton.Content>
                                                </ToggleButton>
                                                <ToggleButton
                                                    Margin="0"
                                                    super:CommonExt.CornerRadius="0"
                                                    BorderBrush="{DynamicResource Button.Selected.BorderBrush}"
                                                    BorderThickness="0,0,2,0"
                                                    SnapsToDevicePixels="True"
                                                    Style="{StaticResource FlatToggleButton}">
                                                    <ToggleButton.Content>
                                                        <StackPanel Orientation="Vertical">
                                                            <TextBlock
                                                                Margin="0"
                                                                FontSize="10"
                                                                Style="{StaticResource BaseTextBlock}"
                                                                Text="监" />
                                                            <TextBlock
                                                                Margin="0"
                                                                FontSize="10"
                                                                Style="{StaticResource BaseTextBlock}"
                                                                Text="视" />
                                                            <TextBlock
                                                                Margin="0"
                                                                FontSize="10"
                                                                Style="{StaticResource BaseTextBlock}"
                                                                Text="器" />
                                                        </StackPanel>
                                                    </ToggleButton.Content>
                                                </ToggleButton>
                                            </StackPanel>
                                        </Grid>
                                    </Grid>

                                    <Grid
                                        Name="advancedGrid"
                                        Grid.Row="0"
                                        Height="260"
                                        Margin="250,0,0,0"
                                        HorizontalAlignment="Left"
                                        VerticalAlignment="Bottom"
                                        Panel.ZIndex="10"
                                        Visibility="Hidden">
                                        <Border
                                            Margin="5"
                                            Background="{DynamicResource Menu.Background}"
                                            CornerRadius="5"
                                            Effect="{StaticResource PopupDropShadowEffect}" />
                                        <Grid>
                                            <Grid.RowDefinitions>
                                                <RowDefinition Height="*" />
                                                <RowDefinition Height="auto" />
                                            </Grid.RowDefinitions>
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="auto" />
                                                <ColumnDefinition Width="2" />
                                                <ColumnDefinition Width="auto" />
                                            </Grid.ColumnDefinitions>
                                            <StackPanel
                                                Grid.Row="0"
                                                Margin="10"
                                                Orientation="Vertical">
                                                <StackPanel
                                                    Margin="5,0"
                                                    Orientation="Horizontal"
                                                    Tag="{Binding Name}">
                                                    <TextBlock
                                                        Width="60"
                                                        FontSize="12"
                                                        Style="{StaticResource BaseTextBlock}"
                                                        Text="{DynamicResource Encoding}"
                                                        TextAlignment="Right" />
                                                    <ComboBox
                                                        MinWidth="120"
                                                        VerticalAlignment="Center"
                                                        FontSize="12"
                                                        ItemsSource="{Binding DataContext.Encodings, RelativeSource={RelativeSource Mode=FindAncestor, AncestorType={x:Type Window}}}"
                                                        SelectionChanged="OnPortSettingChanged"
                                                        Text="{Binding SerialPort.PortEncoding, Mode=TwoWay}">
                                                        <ComboBox.Style>
                                                            <Style BasedOn="{StaticResource BorderComboBox}" TargetType="ComboBox">
                                                                <Setter Property="SelectedIndex">
                                                                    <Setter.Value>
                                                                        <MultiBinding Converter="{StaticResource ComboBoxSelectedIndexConverter}" Mode="OneWay">
                                                                            <Binding Path="SerialPort.PortEncoding" />
                                                                            <Binding Path="DataContext.Encodings" RelativeSource="{RelativeSource Mode=FindAncestor, AncestorType={x:Type Window}}" />
                                                                        </MultiBinding>
                                                                    </Setter.Value>
                                                                </Setter>
                                                            </Style>
                                                        </ComboBox.Style>
                                                    </ComboBox>
                                                </StackPanel>
                                                <StackPanel
                                                    Margin="5,0"
                                                    Orientation="Horizontal"
                                                    Tag="{Binding Name}">
                                                    <TextBlock
                                                        Width="60"
                                                        FontSize="12"
                                                        Style="{StaticResource BaseTextBlock}"
                                                        Text="{DynamicResource Parity}"
                                                        TextAlignment="Right" />
                                                    <ComboBox
                                                        MinWidth="120"
                                                        VerticalAlignment="Center"
                                                        FontSize="12"
                                                        ItemsSource="{Binding DataContext.Parities, RelativeSource={RelativeSource Mode=FindAncestor, AncestorType={x:Type Window}}}"
                                                        SelectionChanged="OnPortSettingChanged"
                                                        Text="{Binding SerialPort.ParityString, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}">
                                                        <ComboBox.Style>
                                                            <Style BasedOn="{StaticResource BorderComboBox}" TargetType="ComboBox">
                                                                <Setter Property="SelectedIndex">
                                                                    <Setter.Value>
                                                                        <MultiBinding Converter="{StaticResource ComboBoxSelectedIndexConverter}" Mode="OneWay">
                                                                            <Binding Path="SerialPort.ParityString" />
                                                                            <Binding Path="DataContext.Paritys" RelativeSource="{RelativeSource Mode=FindAncestor, AncestorType={x:Type Window}}" />
                                                                        </MultiBinding>
                                                                    </Setter.Value>
                                                                </Setter>
                                                            </Style>
                                                        </ComboBox.Style>
                                                    </ComboBox>
                                                </StackPanel>
                                                <StackPanel
                                                    Margin="5,0"
                                                    Orientation="Horizontal"
                                                    Tag="{Binding Name}">
                                                    <TextBlock
                                                        Width="60"
                                                        FontSize="12"
                                                        Style="{StaticResource BaseTextBlock}"
                                                        Text="{DynamicResource StopBits}"
                                                        TextAlignment="Right" />
                                                    <ComboBox
                                                        MinWidth="120"
                                                        VerticalAlignment="Center"
                                                        FontSize="12"
                                                        ItemsSource="{Binding DataContext.StopBits, RelativeSource={RelativeSource Mode=FindAncestor, AncestorType={x:Type Window}}}"
                                                        SelectionChanged="OnPortSettingChanged"
                                                        Text="{Binding SerialPort.StopBitsString, Mode=TwoWay}">
                                                        <ComboBox.Style>
                                                            <Style BasedOn="{StaticResource BorderComboBox}" TargetType="ComboBox">
                                                                <Setter Property="SelectedIndex">
                                                                    <Setter.Value>
                                                                        <MultiBinding Converter="{StaticResource ComboBoxSelectedIndexConverter}" Mode="OneWay">
                                                                            <Binding Path="SerialPort.StopBitsString" />
                                                                            <Binding Path="DataContext.StopBits" RelativeSource="{RelativeSource Mode=FindAncestor, AncestorType={x:Type Window}}" />
                                                                        </MultiBinding>
                                                                    </Setter.Value>
                                                                </Setter>
                                                            </Style>
                                                        </ComboBox.Style>
                                                    </ComboBox>
                                                </StackPanel>

                                                <StackPanel
                                                    Margin="5"
                                                    Orientation="Horizontal"
                                                    Tag="{Binding Name}">
                                                    <TextBlock
                                                        Width="60"
                                                        FontSize="12"
                                                        Style="{StaticResource BaseTextBlock}"
                                                        Text="DTR"
                                                        TextAlignment="Right" />
                                                    <super:Switch
                                                        Height="20"
                                                        Margin="5,0"
                                                        Background="{DynamicResource Window.Title.Background}"
                                                        Click="OnPortSettingChanged"
                                                        IsChecked="{Binding SerialPort.DtrEnable, Mode=TwoWay}" />

                                                    <super:HoverPath Style="{StaticResource HelpHoverPath}" ToolTip="Data Terminal Ready, 通信控制信号&#x0a;更多请访问顶部菜单栏：高级——文献——Serial and UART Tutorial" />

                                                </StackPanel>
                                                <StackPanel
                                                    Margin="5"
                                                    Orientation="Horizontal"
                                                    Tag="{Binding Name}">
                                                    <TextBlock
                                                        Width="60"
                                                        FontSize="12"
                                                        Style="{StaticResource BaseTextBlock}"
                                                        Text="RTS"
                                                        TextAlignment="Right" />
                                                    <super:Switch
                                                        Height="20"
                                                        Margin="5,0"
                                                        Background="{DynamicResource Window.Title.Background}"
                                                        Click="OnPortSettingChanged"
                                                        IsChecked="{Binding SerialPort.RtsEnable, Mode=TwoWay}">
                                                        <!--<super:Switch.Style>
                                                            <Style TargetType="{x:Type super:Switch}">
                                                                <Style.Triggers>
                                                                    <DataTrigger Binding="{Binding SerialPort.Handshake}" Value="2">
                                                                        <Setter Property="IsEnabled" Value="False" />
                                                                    </DataTrigger>
                                                                    <DataTrigger Binding="{Binding SerialPort.Handshake}" Value="3">
                                                                        <Setter Property="IsEnabled" Value="False" />
                                                                    </DataTrigger>
                                                                </Style.Triggers>
                                                            </Style>
                                                        </super:Switch.Style>-->
                                                    </super:Switch>
                                                    <super:HoverPath Style="{StaticResource HelpHoverPath}" ToolTip="Request to Send， 流量控制机制&#x0a;更多请访问顶部菜单栏：高级——文献——Serial and UART Tutorial" />

                                                </StackPanel>

                                                <StackPanel
                                                    Margin="5"
                                                    Orientation="Horizontal"
                                                    Tag="{Binding Name}"
                                                    Visibility="Collapsed">
                                                    <TextBlock
                                                        Width="60"
                                                        FontSize="12"
                                                        Style="{StaticResource BaseTextBlock}"
                                                        Text="{DynamicResource Interrupt}"
                                                        TextAlignment="Right" />
                                                    <super:Switch
                                                        Height="20"
                                                        Margin="5,0"
                                                        Background="{DynamicResource Window.Title.Background}"
                                                        Click="OnPortSettingChanged"
                                                        IsEnabled="{Binding Connected}" />

                                                    <super:HoverPath Style="{StaticResource HelpHoverPath}" ToolTip="中断信号状态发生在传输暂停时，线路处于中断状态（全低，无停止位）直到被释放" />
                                                </StackPanel>

                                            </StackPanel>

                                            <Rectangle
                                                Grid.Row="0"
                                                Grid.Column="1"
                                                Width="2"
                                                Margin="0,20"
                                                Fill="{DynamicResource Window.Sub.Foreground}"
                                                RadiusX="2"
                                                RadiusY="2" />

                                            <StackPanel
                                                Grid.Row="0"
                                                Grid.Column="2"
                                                Margin="10"
                                                Orientation="Vertical">


                                                <StackPanel
                                                    Margin="5"
                                                    Orientation="Horizontal"
                                                    Tag="{Binding Name}">
                                                    <TextBlock
                                                        Width="60"
                                                        FontSize="12"
                                                        Style="{StaticResource BaseTextBlock}"
                                                        Text="{DynamicResource ReadTimeout}"
                                                        TextAlignment="Right" />
                                                    <super:SearchBox
                                                        Width="100"
                                                        Height="30"
                                                        VerticalAlignment="Center"
                                                        FontSize="10"
                                                        ShowClearButton="False"
                                                        Style="{StaticResource SearchTextBoxStyle}"
                                                        Text="{Binding SerialPort.ReadTimeoutValue, Mode=TwoWay}"
                                                        TextAlignment="Center"
                                                        TextChanged="OnPortSettingChanged" />
                                                    <TextBlock VerticalAlignment="Center" Text="ms" />
                                                </StackPanel>
                                                <StackPanel
                                                    Margin="5"
                                                    Orientation="Horizontal"
                                                    Tag="{Binding Name}">
                                                    <TextBlock
                                                        Width="60"
                                                        FontSize="12"
                                                        Style="{StaticResource BaseTextBlock}"
                                                        Text="{DynamicResource WriteTimeout}"
                                                        TextAlignment="Right" />
                                                    <super:SearchBox
                                                        Width="100"
                                                        Height="30"
                                                        VerticalAlignment="Center"
                                                        FontSize="10"
                                                        ShowClearButton="False"
                                                        Style="{StaticResource SearchTextBoxStyle}"
                                                        Text="{Binding SerialPort.WriteTimeoutValue, Mode=TwoWay}"
                                                        TextAlignment="Center"
                                                        TextChanged="OnPortSettingChanged" />
                                                    <TextBlock VerticalAlignment="Center" Text="ms" />
                                                </StackPanel>
                                                <StackPanel
                                                    Margin="5"
                                                    Orientation="Horizontal"
                                                    Tag="{Binding Name}">
                                                    <TextBlock
                                                        Width="60"
                                                        FontSize="12"
                                                        Style="{StaticResource BaseTextBlock}"
                                                        Text="{DynamicResource SubcontractingTimeout}"
                                                        TextAlignment="Right" />
                                                    <super:SearchBox
                                                        Width="100"
                                                        Height="30"
                                                        VerticalAlignment="Center"
                                                        FontSize="10"
                                                        ShowClearButton="False"
                                                        Style="{StaticResource SearchTextBoxStyle}"
                                                        Text="{Binding SerialPort.SubcontractingTimeoutValue, Mode=TwoWay}"
                                                        TextAlignment="Center"
                                                        TextChanged="OnPortSettingChanged" />
                                                    <TextBlock VerticalAlignment="Center" Text="ms" />
                                                </StackPanel>

                                                <StackPanel
                                                    Margin="5,0"
                                                    Orientation="Horizontal"
                                                    Tag="{Binding Name}">
                                                    <TextBlock
                                                        Width="60"
                                                        FontSize="12"
                                                        Style="{StaticResource BaseTextBlock}"
                                                        Text="{DynamicResource HandShake}"
                                                        TextAlignment="Right" />
                                                    <ComboBox
                                                        MinWidth="120"
                                                        VerticalAlignment="Center"
                                                        FontSize="12"
                                                        ItemsSource="{Binding DataContext.HandShakes, RelativeSource={RelativeSource Mode=FindAncestor, AncestorType={x:Type Window}}}"
                                                        SelectionChanged="OnPortSettingChanged"
                                                        Text="{Binding SerialPort.Handshake, Mode=TwoWay}">
                                                        <ComboBox.Style>
                                                            <Style BasedOn="{StaticResource BorderComboBox}" TargetType="ComboBox">
                                                                <Setter Property="SelectedIndex">
                                                                    <Setter.Value>
                                                                        <MultiBinding Converter="{StaticResource ComboBoxSelectedIndexConverter}" Mode="OneWay">
                                                                            <Binding Path="SerialPort.Handshake" />
                                                                            <Binding Path="DataContext.HandShakes" RelativeSource="{RelativeSource Mode=FindAncestor, AncestorType={x:Type Window}}" />
                                                                        </MultiBinding>
                                                                    </Setter.Value>
                                                                </Setter>
                                                            </Style>
                                                        </ComboBox.Style>
                                                    </ComboBox>
                                                </StackPanel>

                                                <StackPanel
                                                    Margin="5"
                                                    Orientation="Horizontal"
                                                    Tag="{Binding Name}">
                                                    <TextBlock
                                                        Width="60"
                                                        FontSize="12"
                                                        Style="{StaticResource BaseTextBlock}"
                                                        Text="{DynamicResource IgnoreNullChar}"
                                                        TextAlignment="Right" />
                                                    <super:Switch
                                                        Height="20"
                                                        Margin="5,0"
                                                        Background="{DynamicResource Window.Title.Background}"
                                                        Click="OnPortSettingChanged"
                                                        IsChecked="{Binding SerialPort.DiscardNull, Mode=TwoWay}" />
                                                </StackPanel>
                                            </StackPanel>

                                            <StackPanel
                                                Grid.Row="1"
                                                Grid.ColumnSpan="3"
                                                Margin="0,0,0,20"
                                                HorizontalAlignment="Center"
                                                VerticalAlignment="Bottom"
                                                Orientation="Horizontal"
                                                Tag="{Binding Name}">
                                                <Button
                                                    Click="HideAdvancedGrid"
                                                    Content="{DynamicResource Close}"
                                                    Style="{StaticResource ButtonDanger}" />
                                                <Button
                                                    Click="RestorePortSetting"
                                                    Content="{DynamicResource Restore}"
                                                    Style="{StaticResource ButtonPrimary}"
                                                    Visibility="Collapsed" />
                                            </StackPanel>
                                        </Grid>

                                    </Grid>




                                    <GridSplitter
                                        Grid.Row="1"
                                        Height="4"
                                        HorizontalAlignment="Stretch"
                                        Panel.ZIndex="10"
                                        Style="{StaticResource HoverSpliter}" />

                                    <Grid Grid.Row="2">
                                        <Grid.RowDefinitions>
                                            <RowDefinition Height="auto" />
                                            <RowDefinition Height="auto" />
                                            <RowDefinition Height="*" />
                                        </Grid.RowDefinitions>
                                        <Border
                                            Grid.Row="0"
                                            Margin="0,0,5,0"
                                            Padding="5,0"
                                            Background="{DynamicResource Window.Title.Background}"
                                            CornerRadius="5">
                                            <WrapPanel Orientation="Horizontal" Tag="{Binding Name}">
                                                <TextBlock
                                                    FontSize="12"
                                                    Style="{StaticResource BaseTextBlock}"
                                                    Text="{DynamicResource BaudRate}" />
                                                <ComboBox
                                                    x:Name="baudRateComboBox"
                                                    MinWidth="120"
                                                    VerticalAlignment="Center"
                                                    FontSize="12"
                                                    ItemsSource="{Binding DataContext.BaudRates, RelativeSource={RelativeSource Mode=FindAncestor, AncestorType={x:Type Window}}}"
                                                    SelectionChanged="BaudRate_SelectionChanged"
                                                    Tag="{Binding Name}"
                                                    Text="{Binding SerialPort.BaudRate, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}">
                                                    <ComboBox.Style>
                                                        <Style BasedOn="{StaticResource BorderComboBox}" TargetType="ComboBox">
                                                            <Setter Property="SelectedIndex">
                                                                <Setter.Value>
                                                                    <MultiBinding Converter="{StaticResource ComboBoxSelectedIndexConverter}" Mode="OneWay">
                                                                        <Binding Path="SerialPort.BaudRate" />
                                                                        <Binding Path="DataContext.BaudRates" RelativeSource="{RelativeSource Mode=FindAncestor, AncestorType={x:Type Window}}" />
                                                                    </MultiBinding>
                                                                </Setter.Value>
                                                            </Setter>
                                                        </Style>
                                                    </ComboBox.Style>
                                                </ComboBox>
                                                <TextBlock
                                                    FontSize="12"
                                                    Style="{StaticResource BaseTextBlock}"
                                                    Text="{DynamicResource DataBits}" />
                                                <ComboBox
                                                    MinWidth="70"
                                                    VerticalAlignment="Center"
                                                    FontSize="12"
                                                    ItemsSource="{Binding DataContext.DataBits, RelativeSource={RelativeSource Mode=FindAncestor, AncestorType={x:Type Window}}}"
                                                    SelectionChanged="OnPortSettingChanged"
                                                    Text="{Binding SerialPort.DataBits, Mode=TwoWay}">
                                                    <ComboBox.Style>
                                                        <Style BasedOn="{StaticResource BorderComboBox}" TargetType="ComboBox">
                                                            <Setter Property="SelectedIndex">
                                                                <Setter.Value>
                                                                    <MultiBinding Converter="{StaticResource ComboBoxSelectedIndexConverter}" Mode="OneWay">
                                                                        <Binding Path="SerialPort.DataBits" />
                                                                        <Binding Path="DataContext.DataBits" RelativeSource="{RelativeSource Mode=FindAncestor, AncestorType={x:Type Window}}" />
                                                                    </MultiBinding>
                                                                </Setter.Value>
                                                            </Setter>
                                                        </Style>
                                                    </ComboBox.Style>
                                                </ComboBox>
                                                <StackPanel
                                                    Margin="5"
                                                    Orientation="Horizontal"
                                                    Tag="{Binding Name}">
                                                    <TextBlock
                                                        Width="80"
                                                        FontSize="12"
                                                        Style="{StaticResource BaseTextBlock}"
                                                        Text="{DynamicResource ShowEscCommand}"
                                                        TextAlignment="Right" />
                                                    <super:Switch
                                                        Height="20"
                                                        Margin="5,0"
                                                        Background="{DynamicResource Window.Title.Background}"
                                                        Click="OnPortSettingChanged"
                                                        IsChecked="{Binding SerialPort.ShowEscCommand, Mode=TwoWay}" />
                                                </StackPanel>
                                                <StackPanel
                                                    Margin="5"
                                                    Orientation="Horizontal"
                                                    Tag="{Binding Name}">
                                                    <TextBlock
                                                        Width="80"
                                                        FontSize="12"
                                                        Style="{StaticResource BaseTextBlock}"
                                                        Text="{DynamicResource HideDuplicateCRLF}"
                                                        TextAlignment="Right" />
                                                    <super:Switch
                                                        Height="20"
                                                        Margin="5,0"
                                                        Background="{DynamicResource Window.Title.Background}"
                                                        Click="OnPortSettingChanged"
                                                        IsChecked="{Binding SerialPort.HideDuplicateCRLF, Mode=TwoWay}" />
                                                </StackPanel>                                                
                                                <StackPanel
                                                    Margin="5"
                                                    Orientation="Horizontal"
                                                    Tag="{Binding Name}">
                                                    <TextBlock
                                                        Width="80"
                                                        FontSize="12"
                                                        Style="{StaticResource BaseTextBlock}"
                                                        Text="{DynamicResource UseTXDAsDTR}"
                                                        TextAlignment="Right" />
                                                    <super:Switch
                                                        Height="20"
                                                        Margin="5,0"
                                                        Background="{DynamicResource Window.Title.Background}"
                                                        Click="OnPortSettingChanged"
                                                        IsChecked="{Binding SerialPort.UseTXDAsDTR, Mode=TwoWay}" />
                                                </StackPanel> 
                                                <Button
                                                    Margin="5"
                                                    VerticalAlignment="Center"
                                                    Click="ShowAdvancedOptions"
                                                    Content="{DynamicResource MorePortSettings}" />
                                                

                                                <TextBlock
                                                    Margin="10,0,5,0"
                                                    HorizontalAlignment="Left"
                                                    FontSize="12"
                                                    FontWeight="Bold"
                                                    Style="{StaticResource BaseTextBlock}"
                                                    Text="{DynamicResource HighLighting}" />

                                                <ComboBox
                                                    Name="highlightingComboBox"
                                                    MinWidth="130"
                                                    Margin="5,0"
                                                    VerticalAlignment="Center"
                                                    FontSize="12"
                                                    FontWeight="Bold"
                                                    ItemsSource="{Binding DataContext.HighlightingDefinitions, RelativeSource={RelativeSource Mode=FindAncestor, AncestorType={x:Type Window}}}"
                                                    SelectedIndex="{Binding SerialPort.HighLightIndex, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                                    SelectionChanged="highlightingComboBox_SelectionChanged"
                                                    Style="{StaticResource BorderComboBox}"
                                                    Tag="{Binding Name}" />
                                                <Button
                                                    Margin="5,0"
                                                    BorderBrush="{DynamicResource Button.Selected.BorderBrush}"
                                                    Click="ShowHighLightEdit"
                                                    Content="{DynamicResource Edit}"
                                                    FontSize="10"
                                                    Style="{StaticResource BorderButton}"
                                                    Tag="{Binding Name}" />

                                                <super:Switch
                                                    Height="20"
                                                    VerticalAlignment="Center"
                                                    Background="{DynamicResource Window.Title.Background}"
                                                    IsChecked="{Binding EnabledFilter, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                                    Visibility="Collapsed" />
                                                <TextBlock
                                                    VerticalAlignment="Center"
                                                    Style="{StaticResource BaseTextBlock}"
                                                    Text="{DynamicResource Percolator}"
                                                    ToolTip="过滤规则同语法高亮"
                                                    Visibility="Collapsed" />

                                            </WrapPanel>
                                        </Border>

                                        <Border
                                            Name="sendBorder"
                                            Grid.Row="1"
                                            Margin="0,5,5,0"
                                            Padding="5,0"
                                            Background="{DynamicResource Window.Title.Background}"
                                            CornerRadius="5"
                                            Tag="{Binding Name}">
                                            <Grid>
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition Width="auto" />
                                                    <ColumnDefinition Width="*" />
                                                </Grid.ColumnDefinitions>

                                                <StackPanel
                                                    Grid.Column="0"
                                                    VerticalAlignment="Top"
                                                    Orientation="Horizontal">


                                                    <Button
                                                        Margin="5,0"
                                                        VerticalAlignment="Center"
                                                        Click="OpenSendPanel"
                                                        Content="{DynamicResource EditCommand}"
                                                        IsEnabled="{Binding RunningCommands, Converter={StaticResource OppositeBooleanConverter}}"
                                                        Tag="{Binding ElementName=commandsComboBox, Path=SelectedIndex}" />

                                                    <Button
                                                        Width="25"
                                                        Height="25"
                                                        Margin="0"
                                                        Padding="0"
                                                        VerticalAlignment="Stretch"
                                                        super:CommonExt.CornerRadius="5"
                                                        super:CommonExt.HoverBackground="{DynamicResource Window.Title.Hover.Background}"
                                                        Click="StartSendCommands"
                                                        Style="{StaticResource FlatButton}"
                                                        Tag="{Binding Name}">
                                                        <Viewbox
                                                            Width="12"
                                                            Height="auto"
                                                            VerticalAlignment="Center">
                                                            <Path
                                                                HorizontalAlignment="Center"
                                                                VerticalAlignment="Center"
                                                                Data="M128 138.666667c0-47.232 33.322667-66.666667 74.176-43.562667l663.146667 374.954667c40.96 23.168 40.853333 60.8 0 83.882666L202.176 928.896C161.216 952.064 128 932.565333 128 885.333333v-746.666666z"
                                                                Effect="{StaticResource PopupDropShadowEffect}">
                                                                <Path.Style>
                                                                    <Style TargetType="Path">
                                                                        <Style.Triggers>
                                                                            <DataTrigger Binding="{Binding IsEnabled, RelativeSource={RelativeSource Mode=FindAncestor, AncestorType={x:Type Button}}}" Value="False">
                                                                                <Setter Property="Fill" Value="Gray" />
                                                                            </DataTrigger>
                                                                            <DataTrigger Binding="{Binding IsEnabled, RelativeSource={RelativeSource Mode=FindAncestor, AncestorType={x:Type Button}}}" Value="True">
                                                                                <Setter Property="Fill" Value="#99E699" />
                                                                            </DataTrigger>
                                                                        </Style.Triggers>
                                                                    </Style>
                                                                </Path.Style>
                                                            </Path>
                                                        </Viewbox>
                                                    </Button>

                                                    <Button
                                                        Width="25"
                                                        Height="25"
                                                        Margin="5,0"
                                                        Padding="0"
                                                        VerticalAlignment="Stretch"
                                                        super:CommonExt.CornerRadius="5"
                                                        super:CommonExt.HoverBackground="{DynamicResource Window.Title.Hover.Background}"
                                                        Click="StopSendCommands"
                                                        IsEnabled="False"
                                                        Style="{StaticResource FlatButton}"
                                                        Tag="{Binding Name}">

                                                        <Viewbox
                                                            Width="12"
                                                            Height="auto"
                                                            HorizontalAlignment="Left"
                                                            VerticalAlignment="Center">
                                                            <Path
                                                                HorizontalAlignment="Center"
                                                                VerticalAlignment="Center"
                                                                Data="M128 128m53.333333 0l661.333334 0q53.333333 0 53.333333 53.333333l0 661.333334q0 53.333333-53.333333 53.333333l-661.333334 0q-53.333333 0-53.333333-53.333333l0-661.333334q0-53.333333 53.333333-53.333333Z"
                                                                Effect="{StaticResource PopupDropShadowEffect}">
                                                                <Path.Style>
                                                                    <Style TargetType="Path">
                                                                        <Style.Triggers>
                                                                            <DataTrigger Binding="{Binding IsEnabled, RelativeSource={RelativeSource Mode=FindAncestor, AncestorType={x:Type Button}}}" Value="False">
                                                                                <Setter Property="Fill" Value="Gray" />
                                                                            </DataTrigger>
                                                                            <DataTrigger Binding="{Binding IsEnabled, RelativeSource={RelativeSource Mode=FindAncestor, AncestorType={x:Type Button}}}" Value="True">
                                                                                <Setter Property="Fill" Value="#C85860" />
                                                                            </DataTrigger>
                                                                        </Style.Triggers>
                                                                    </Style>
                                                                </Path.Style>
                                                            </Path>
                                                        </Viewbox>
                                                    </Button>
                                                    <ComboBox
                                                        Name="commandsComboBox"
                                                        MinWidth="50"
                                                        VerticalAlignment="Center"
                                                        DisplayMemberPath="ProjectName"
                                                        IsEnabled="{Binding RunningCommands, Converter={StaticResource OppositeBooleanConverter}}"
                                                        ItemsSource="{Binding Path=DataContext.SendCommandProjects, RelativeSource={RelativeSource AncestorType={x:Type super:BaseWindow}}}"
                                                        SelectedIndex="{Binding CommandsSelectIndex, Mode=OneWay}"
                                                        SelectedValuePath="ProjectID"
                                                        SelectionChanged="ComboBox_SelectionChanged"
                                                        Style="{StaticResource BorderComboBox}" />
                                                </StackPanel>
                                                <ItemsControl
                                                    Grid.Column="3"
                                                    Margin="5,0"
                                                    IsEnabled="{Binding RunningCommands, Converter={StaticResource OppositeBooleanConverter}}">
                                                    <ItemsControl.ItemsPanel>
                                                        <ItemsPanelTemplate>
                                                            <WrapPanel VerticalAlignment="Center" Orientation="Horizontal" />
                                                        </ItemsPanelTemplate>
                                                    </ItemsControl.ItemsPanel>
                                                    <ItemsControl.ItemTemplate>
                                                        <DataTemplate>
                                                            <Button
                                                                Margin="5"
                                                                VerticalAlignment="Center"
                                                                BorderBrush="{DynamicResource Button.Selected.BorderBrush}"
                                                                Click="SendCustomCommand"
                                                                Content="{Binding Name, TargetNullValue=发送命令}"
                                                                PreviewMouseRightButtonUp="Button_PreviewMouseRightButtonUp"
                                                                Style="{StaticResource BorderButton}"
                                                                Tag="{Binding CommandID}"
                                                                ToolTip="{Binding Command}">
                                                                <Button.ContextMenu>
                                                                    <ContextMenu>
                                                                        <MenuItem Click="EditSendCommand" Header="{DynamicResource Edit}" />
                                                                        <MenuItem
                                                                            super:CommonExt.HoverBackground="{DynamicResource Menu.Hover.Deep.Background}"
                                                                            Click="DeleteSendCommand"
                                                                            Header="{DynamicResource Delete}" />
                                                                    </ContextMenu>
                                                                </Button.ContextMenu>
                                                            </Button>
                                                        </DataTemplate>
                                                    </ItemsControl.ItemTemplate>
                                                </ItemsControl>


                                            </Grid>
                                        </Border>


                                        <Grid
                                            Grid.Row="2"
                                            MinHeight="100"
                                            Tag="{Binding Name, Mode=OneWay}">
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="auto" />
                                                <ColumnDefinition Width="*" />
                                                <ColumnDefinition Width="100" />
                                            </Grid.ColumnDefinitions>
                                            <StackPanel Grid.Column="0" Margin="6">
                                                <ToggleButton
                                                    MinWidth="40"
                                                    Margin="5"
                                                    Padding="5"
                                                    HorizontalAlignment="Center"
                                                    VerticalAlignment="Bottom"
                                                    IsChecked="{Binding AddNewLineWhenWrite, Mode=TwoWay}"
                                                    Opacity="0.8"
                                                    Style="{StaticResource FlatToggleButton}"
                                                    ToolTip="{DynamicResource AddReturn}">
                                                    <Viewbox
                                                        Width="15"
                                                        Height="auto"
                                                        VerticalAlignment="Center">
                                                        <Path Data="M896 160C896 177.664 881.664 192 864 192l-768 0C78.336 192 64 177.664 64 160l0 0C64 142.336 78.336 128 96 128l768 0C881.664 128 896 142.336 896 160L896 160zM896 352C896 334.336 881.664 320 864 320l-768 0C78.336 320 64 334.336 64 352l0 0C64 369.664 78.336 384 96 384l768 0C881.664 384 896 369.664 896 352L896 352zM384 736C384 718.336 369.664 704 352 704l-256 0C78.336 704 64 718.336 64 736l0 0C64 753.664 78.336 768 96 768l256 0C369.664 768 384 753.664 384 736L384 736zM735.168 512 732.8 512 599.232 512 96 512C78.336 512 64 526.336 64 544S78.336 576 96 576l503.232 0 133.568 0 2.368 0c52.928 0 96 43.072 96 96s-43.072 96-96 96L568.96 768l0-2.112L568.576 765.888l64.128-64.128c12.8-12.8 12.8-33.664 0-46.528-12.864-12.864-33.6-12.864-46.528 0l-120.192 120.192c-6.208 6.208-9.6 14.592-9.6 23.296 0 8.704 3.456 17.024 9.6 23.232l120.192 120.128c12.864 12.736 33.6 12.736 46.528 0 12.864-12.864 12.864-33.6 0-46.592L569.024 832l166.208 0c88.256 0 160-71.744 160-160S823.424 512 735.168 512z" Fill="{DynamicResource Window.Foreground}" />

                                                    </Viewbox>
                                                </ToggleButton>
                                                <ToggleButton
                                                    MinWidth="40"
                                                    Margin="5"
                                                    Padding="5"
                                                    HorizontalAlignment="Left"
                                                    VerticalAlignment="Bottom"
                                                    IsChecked="{Binding SendHex, Mode=TwoWay}"
                                                    Opacity="0.8">
                                                    <ToggleButton.Style>
                                                        <Style BasedOn="{StaticResource FlatToggleButton}" TargetType="ToggleButton">
                                                            <Setter Property="Content" Value="STR" />
                                                            <Setter Property="ToolTip" Value="{DynamicResource ModeSendString}" />
                                                            <Style.Triggers>
                                                                <Trigger Property="IsChecked" Value="True">
                                                                    <Setter Property="Content" Value="HEX" />
                                                                    <Setter Property="ToolTip" Value="{DynamicResource ModeSendHex}" />
                                                                </Trigger>
                                                            </Style.Triggers>
                                                        </Style>
                                                    </ToggleButton.Style>
                                                </ToggleButton>
                                            </StackPanel>
                                            <Border
                                                Grid.Column="1"
                                                Margin="0,5"
                                                Background="{DynamicResource Window.Side.Background}"
                                                BorderThickness="1"
                                                CornerRadius="5">
                                                <Border.Style>
                                                    <Style TargetType="Border">
                                                        <Style.Triggers>
                                                            <DataTrigger Binding="{Binding ElementName=sendTextBox, Path=IsFocused}" Value="True">
                                                                <Setter Property="BorderBrush" Value="{DynamicResource Button.Selected.BorderBrush}" />
                                                            </DataTrigger>
                                                        </Style.Triggers>
                                                    </Style>
                                                </Border.Style>
                                                <Grid>
                                                    <Grid.RowDefinitions>
                                                        <RowDefinition Height="*" />
                                                        <RowDefinition Height="auto" />
                                                    </Grid.RowDefinitions>
                                                    <TextBox
                                                        Name="sendTextBox"
                                                        Grid.Row="0"
                                                        Margin="10"
                                                        VerticalAlignment="Stretch"
                                                        AcceptsReturn="False"
                                                        Background="Transparent"
                                                        BorderThickness="0"
                                                        CaretBrush="{DynamicResource Window.Foreground}"
                                                        ContextMenu="{StaticResource TextBoxContextMenu}"
                                                        Foreground="{DynamicResource Window.Foreground}"
                                                        PreviewKeyDown="SendTextBox_PreviewKeyDown"
                                                        ScrollViewer.VerticalScrollBarVisibility="Auto"
                                                        Tag="{Binding Name, Mode=OneWay}"
                                                        Text="{Binding WriteData, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                                        TextChanged="SendTextBox_TextChanged"
                                                        TextWrapping="Wrap" />
                                                    <Border Grid.Row="1" Margin="0">
                                                        <Border.Style>
                                                            <Style BasedOn="{StaticResource InfoBorder}" TargetType="Border">
                                                                <Setter Property="Visibility" Value="Collapsed" />
                                                                <Style.Triggers>
                                                                    <DataTrigger Binding="{Binding SendHex}" Value="True">
                                                                        <Setter Property="Visibility" Value="Visible" />
                                                                    </DataTrigger>
                                                                </Style.Triggers>
                                                            </Style>
                                                        </Border.Style>
                                                        <Grid>
                                                            <Grid.ColumnDefinitions>
                                                                <ColumnDefinition Width="auto" />
                                                                <ColumnDefinition Width="*" />
                                                            </Grid.ColumnDefinitions>

                                                            <Popup
                                                                AllowsTransparency="True"
                                                                HorizontalOffset="-10"
                                                                Placement="Top"
                                                                PlacementTarget="{Binding ElementName=dataCheck}"
                                                                PopupAnimation="Fade"
                                                                StaysOpen="False"
                                                                VerticalOffset="-10">
                                                                <Grid
                                                                    MinWidth="500"
                                                                    MinHeight="100"
                                                                    Margin="5">
                                                                    <Border
                                                                        Margin="5"
                                                                        Background="{DynamicResource Menu.Background}"
                                                                        CornerRadius="5"
                                                                        Effect="{StaticResource PopupDropShadowEffect}" />

                                                                    <DockPanel>
                                                                        <Border DockPanel.Dock="Top" Style="{StaticResource InfoBorder}">
                                                                            <TextBlock Style="{StaticResource BaseTextBlock}" Text="计算校验" />
                                                                        </Border>

                                                                        <StackPanel
                                                                            Margin="20,10"
                                                                            Orientation="Vertical"
                                                                            Tag="{Binding RelativeSource={RelativeSource Mode=FindAncestor, AncestorType={x:Type ContextMenu}}}">
                                                                            <DockPanel>
                                                                                <TextBlock
                                                                                    Margin="10,0,20,0"
                                                                                    Style="{StaticResource BaseTextBlock}"
                                                                                    Text="启用" />
                                                                                <CheckBox
                                                                                    Click="SaveDataCheck"
                                                                                    Content="自动计算"
                                                                                    IsChecked="{Binding SerialPort.DataCheck.Enabled, Mode=TwoWay}"
                                                                                    Tag="{Binding Name, Mode=OneWay}" />
                                                                            </DockPanel>
                                                                            <StackPanel Orientation="Vertical" Visibility="{Binding SerialPort.DataCheck.Enabled, Mode=OneWay, Converter={StaticResource BoolToVisibilityConverter}}">
                                                                                <DockPanel>
                                                                                    <TextBlock
                                                                                        Margin="10,0,15,0"
                                                                                        Style="{StaticResource BaseTextBlock}"
                                                                                        Text="方式" />
                                                                                    <ComboBox
                                                                                        MinWidth="100"
                                                                                        DisplayMemberPath="Name"
                                                                                        FontSize="15"
                                                                                        ItemsSource="{Binding DataContext.DataCheckPlugins, RelativeSource={RelativeSource Mode=FindAncestor, AncestorType={x:Type Window}}}"
                                                                                        SelectedIndex="{Binding SerialPort.DataCheck.SelectedIndex, Mode=TwoWay, FallbackValue=0}"
                                                                                        SelectionChanged="SaveDataCheck"
                                                                                        Style="{StaticResource BorderComboBox}"
                                                                                        Tag="{Binding Name, Mode=OneWay}" />
                                                                                </DockPanel>
                                                                                <StackPanel Margin="70,5,0,5" Orientation="Horizontal">
                                                                                    <RadioButton
                                                                                        Click="SaveDataCheck"
                                                                                        Content="添加到末尾"
                                                                                        GroupName="{Binding Name}"
                                                                                        IsChecked="{Binding SerialPort.DataCheck.UseCustom, Mode=OneWay, Converter={StaticResource OppositeBooleanConverter}}"
                                                                                        Style="{StaticResource NormalRadioButton}"
                                                                                        Tag="{Binding Name, Mode=OneWay}" />
                                                                                    <RadioButton
                                                                                        Click="SaveDataCheck"
                                                                                        Content="自定义"
                                                                                        GroupName="{Binding Name}"
                                                                                        IsChecked="{Binding SerialPort.DataCheck.UseCustom, Mode=TwoWay}"
                                                                                        Style="{StaticResource NormalRadioButton}"
                                                                                        Tag="{Binding Name, Mode=OneWay}" />
                                                                                </StackPanel>
                                                                                <StackPanel
                                                                                    Margin="70,0,5,0"
                                                                                    Orientation="Horizontal"
                                                                                    Visibility="{Binding SerialPort.DataCheck.UseCustom, Converter={StaticResource BoolToVisibilityConverter}}">
                                                                                    <TextBlock
                                                                                        FontSize="13"
                                                                                        Style="{StaticResource BaseTextBlock}"
                                                                                        Text="计算第" />
                                                                                    <super:SearchBox
                                                                                        Height="25"
                                                                                        MinWidth="70"
                                                                                        MaxWidth="150"
                                                                                        ShowClearButton="False"
                                                                                        Style="{StaticResource SearchTextBoxStyle}"
                                                                                        Tag="{Binding Name, Mode=OneWay}"
                                                                                        Text="{Binding SerialPort.DataCheck.CustomStart, Mode=TwoWay}"
                                                                                        TextAlignment="Center"
                                                                                        TextChanged="SaveDataCheck" />
                                                                                    <TextBlock
                                                                                        FontSize="13"
                                                                                        Style="{StaticResource BaseTextBlock}"
                                                                                        Text="字节到第" />
                                                                                    <super:SearchBox
                                                                                        Height="25"
                                                                                        MinWidth="70"
                                                                                        MaxWidth="150"
                                                                                        ShowClearButton="False"
                                                                                        Style="{StaticResource SearchTextBoxStyle}"
                                                                                        Tag="{Binding Name, Mode=OneWay}"
                                                                                        Text="{Binding SerialPort.DataCheck.CustomEnd, Mode=TwoWay}"
                                                                                        TextAlignment="Center"
                                                                                        TextChanged="SaveDataCheck" />
                                                                                    <TextBlock
                                                                                        FontSize="13"
                                                                                        Style="{StaticResource BaseTextBlock}"
                                                                                        Text="字节(-1 表示最后一字节)" />
                                                                                </StackPanel>
                                                                                <StackPanel
                                                                                    Margin="70,0,5,0"
                                                                                    Orientation="Horizontal"
                                                                                    Visibility="{Binding SerialPort.DataCheck.UseCustom, Converter={StaticResource BoolToVisibilityConverter}}">
                                                                                    <TextBlock
                                                                                        FontSize="13"
                                                                                        Style="{StaticResource BaseTextBlock}"
                                                                                        Text="并插入到第" />
                                                                                    <super:SearchBox
                                                                                        Height="25"
                                                                                        MinWidth="70"
                                                                                        MaxWidth="150"
                                                                                        ShowClearButton="False"
                                                                                        Style="{StaticResource SearchTextBoxStyle}"
                                                                                        Tag="{Binding Name, Mode=OneWay}"
                                                                                        Text="{Binding SerialPort.DataCheck.CustomInsert, Mode=TwoWay}"
                                                                                        TextAlignment="Center"
                                                                                        TextChanged="SaveDataCheck" />
                                                                                    <TextBlock
                                                                                        FontSize="13"
                                                                                        Style="{StaticResource BaseTextBlock}"
                                                                                        Text="字节后" />
                                                                                </StackPanel>
                                                                            </StackPanel>
                                                                        </StackPanel>
                                                                    </DockPanel>
                                                                </Grid>
                                                            </Popup>


                                                            <Button
                                                                Name="dataCheck"
                                                                Grid.Column="0"
                                                                Width="22"
                                                                Height="22"
                                                                Margin="2"
                                                                Padding="0"
                                                                VerticalAlignment="Stretch"
                                                                super:CommonExt.CornerRadius="5"
                                                                super:CommonExt.HoverBackground="{DynamicResource Window.Title.Hover.Background}"
                                                                Click="ShowHexCheckSettings"
                                                                Style="{StaticResource FlatButton}">
                                                                <Viewbox
                                                                    Width="12"
                                                                    Height="auto"
                                                                    VerticalAlignment="Center">
                                                                    <Path
                                                                        HorizontalAlignment="Center"
                                                                        VerticalAlignment="Center"
                                                                        Data="M866.3 23.2H157.7c-51.7 0-93.8 42.1-93.8 93.8v790.2c0 51.7 42.1 93.8 93.8 93.8h708.6c51.7 0 93.8-42.1 93.8-93.8V116.9c0-51.7-42.1-93.7-93.8-93.7z m44.1 883.9c0 24.3-19.8 44.1-44.1 44.1H157.7c-24.3 0-44.1-19.8-44.1-44.1V116.9c0-24.3 19.8-44.1 44.1-44.1h708.6c24.3 0 44.1 19.8 44.1 44.1v790.2z M778.9 155.2H240.3c-31.4 0-56.9 25.5-56.9 56.9v145.6c0 31.4 25.5 56.9 56.9 56.9h538.6c31.4 0 56.9-25.5 56.9-56.9V212.1c0-31.4-25.5-56.9-56.9-56.9z m7.2 202.5c0 3.9-3.3 7.2-7.2 7.2H240.3c-3.9 0-7.2-3.3-7.2-7.2V212.1c0-3.9 3.3-7.2 7.2-7.2h538.6c3.9 0 7.2 3.3 7.2 7.2v145.6zM786.4 460.9h-82.8c-27.3 0-49.4 22.2-49.4 49.4v304.9c0 27.3 22.2 49.4 49.4 49.4h82.8c27.3 0 49.4-22.2 49.4-49.4V510.4c0-27.3-22.2-49.5-49.4-49.5z m-82.6 354.4l-0.2-304.7 82.6-0.2v304.7l-82.4 0.2zM319.7 460.9h-88.2c-26.5 0-48.1 21.6-48.1 48.1v88.2c0 26.5 21.6 48.1 48.1 48.1h88.2c26.5 0 48.1-21.6 48.1-48.1V509c0.1-26.5-21.5-48.1-48.1-48.1z m-1.5 134.8l-85.1 1.5-1.5-86.6 86.6-1.5v86.6zM551.1 460.9h-88.2c-26.5 0-48.1 21.6-48.1 48.1v88.2c0 26.5 21.6 48.1 48.1 48.1h88.2c26.5 0 48.1-21.6 48.1-48.1V509c0-26.5-21.6-48.1-48.1-48.1z m-1.6 134.8l-85.1 1.5-1.5-86.6 86.6-1.5v86.6zM319.7 680.3h-88.2c-26.5 0-48.1 21.6-48.1 48.1v88.2c0 26.5 21.6 48.1 48.1 48.1h88.2c26.5 0 48.1-21.6 48.1-48.1v-88.2c0.1-26.5-21.5-48.1-48.1-48.1z m-1.5 134.8l-85.1 1.5-1.5-86.6 86.6-1.5v86.6zM551.1 680.3h-88.2c-26.5 0-48.1 21.6-48.1 48.1v88.2c0 26.5 21.6 48.1 48.1 48.1h88.2c26.5 0 48.1-21.6 48.1-48.1v-88.2c0-26.5-21.6-48.1-48.1-48.1z m-1.6 134.8l-85.1 1.5-1.5-86.6 86.6-1.5v86.6z"
                                                                        Fill="{DynamicResource Window.Foreground}" />
                                                                </Viewbox>
                                                            </Button>


                                                            <TextBox
                                                                Grid.Column="1"
                                                                Margin="0"
                                                                FontSize="10"
                                                                Style="{StaticResource ReadOnlyNoWrapTextBox}"
                                                                Text="{Binding SendHexValue}" />
                                                        </Grid>
                                                    </Border>
                                                </Grid>
                                            </Border>

                                            <Popup
                                                x:Name="sendHistoryPopup"
                                                Width="420"
                                                Height="auto"
                                                AllowsTransparency="True"
                                                HorizontalOffset="-10"
                                                Placement="Top"
                                                PlacementTarget="{Binding ElementName=sendTextBox}"
                                                PopupAnimation="Fade"
                                                StaysOpen="False"
                                                Tag="{Binding Name, Mode=OneWay}"
                                                VerticalOffset="-10">
                                                <Grid MaxHeight="600" Margin="5">
                                                    <Border
                                                        Margin="5"
                                                        Background="{DynamicResource Menu.Background}"
                                                        Effect="{StaticResource PopupDropShadowEffect}" />
                                                    <ScrollViewer
                                                        Width="390"
                                                        Margin="0,10"
                                                        HorizontalScrollBarVisibility="Hidden"
                                                        VerticalScrollBarVisibility="auto">
                                                        <ItemsControl
                                                            Name="itemsControl"
                                                            Margin="0,5"
                                                            Background="Transparent">
                                                            <ItemsControl.ItemsPanel>
                                                                <ItemsPanelTemplate>
                                                                    <StackPanel />
                                                                </ItemsPanelTemplate>
                                                            </ItemsControl.ItemsPanel>
                                                            <ItemsControl.ItemTemplate>
                                                                <DataTemplate>
                                                                    <Border
                                                                        x:Name="baseBorder"
                                                                        Margin="5,0"
                                                                        HorizontalAlignment="Stretch"
                                                                        BorderBrush="Transparent"
                                                                        BorderThickness="1"
                                                                        MouseEnter="HistoryMouseEnter"
                                                                        MouseLeave="HistoryMouseLeave"
                                                                        MouseLeftButtonDown="SetSendHistory"
                                                                        Style="{StaticResource HoverBorder}">
                                                                        <Grid>
                                                                            <Grid.ColumnDefinitions>
                                                                                <ColumnDefinition Width="*" />
                                                                                <ColumnDefinition Width="auto" />
                                                                            </Grid.ColumnDefinitions>
                                                                            <TextBlock
                                                                                Grid.Column="0"
                                                                                Style="{StaticResource BaseTextBlock}"
                                                                                Tag="{Binding RelativeSource={RelativeSource Mode=FindAncestor, AncestorType={x:Type Popup}}}"
                                                                                Text="{Binding Path=.}"
                                                                                TextAlignment="Left"
                                                                                TextTrimming="WordEllipsis"
                                                                                TextWrapping="NoWrap" />
                                                                            <Border
                                                                                Grid.Column="1"
                                                                                Background="Transparent"
                                                                                BorderBrush="{StaticResource TabItem.Selected.Background}"
                                                                                Tag="{Binding Path=.}">

                                                                                <super:HoverPath
                                                                                    Width="20"
                                                                                    Height="20"
                                                                                    Margin="5"
                                                                                    HorizontalAlignment="Right"
                                                                                    Click="DeleteSendHistory"
                                                                                    Style="{StaticResource CloseHoverPath}"
                                                                                    Tag="{Binding RelativeSource={RelativeSource Mode=FindAncestor, AncestorType={x:Type Popup}}}" />
                                                                            </Border>
                                                                        </Grid>
                                                                    </Border>
                                                                </DataTemplate>
                                                            </ItemsControl.ItemTemplate>
                                                        </ItemsControl>
                                                    </ScrollViewer>
                                                </Grid>
                                            </Popup>

                                            <Grid Grid.Column="2">



                                                <Button
                                                    Margin="5,5,7,5"
                                                    Padding="10"
                                                    HorizontalAlignment="Stretch"
                                                    VerticalAlignment="Bottom"
                                                    Click="SendCommand"
                                                    Content="{DynamicResource Send}"
                                                    Tag="{Binding Name}" />
                                            </Grid>


                                        </Grid>

                                    </Grid>
                                </Grid>

                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>
                </Grid>


            </Grid>

            <Grid
                Grid.Row="1"
                Height="25"
                Background="{DynamicResource Window.StatusBar.Background}">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="auto" />
                    <ColumnDefinition Width="auto" />
                </Grid.ColumnDefinitions>

                <super:SysInfo Grid.Column="0" />
            </Grid>

        </Grid>

    </Grid>
</super:BaseWindow>
